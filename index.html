<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Center Profile - Dynamic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
color: #e2e8f0;
min-height: 100vh;
overflow-x: hidden;
}

/* Cyberpunk Header */
.header {
background: linear-gradient(90deg, #1e293b 0%, #334155 50%, #1e293b 100%);
padding: 1.5rem 2rem;
border-bottom: 2px solid #3b82f6;
position: relative;
overflow: hidden;
}

.header::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
animation: scan 3s infinite;
}

@keyframes scan {
0% { left: -100%; }
100% { left: 100%; }
}

.header-content {
display: flex;
justify-content: space-between;
align-items: center;
position: relative;
z-index: 2;
}

.company-info h1 {
font-family: 'Poppins', sans-serif;
font-size: 2.5rem;
font-weight: 600;
color: #60a5fa;
text-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
margin-bottom: 0.5rem;
letter-spacing: -0.02em;
}

.company-info .location {
font-family: 'Rajdhani', sans-serif;
font-size: 1.2rem;
color: #94a3b8;
font-weight: 600;
display: flex;
align-items: center;
gap: 1rem;
}

.time-weather-container {
display: flex;
gap: 1rem;
align-items: center;
}

.current-time {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #3b82f6;
padding: 0.5rem 1rem;
border-radius: 0.5rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
color: #60a5fa;
text-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
}

.weather-forecast {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #3b82f6;
padding: 0.75rem 1.25rem;
border-radius: 0.5rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
color: #60a5fa;
text-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
min-width: 300px;
}

.weather-forecast-content {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 0.75rem;
font-size: 1rem;
}

.weather-day {
text-align: center;
padding: 0.3rem;
}

.weather-day-name {
font-size: 0.8rem;
color: #94a3b8;
margin-bottom: 0.2rem;
}

.weather-temp {
font-size: 1rem;
color: #60a5fa;
font-weight: 600;
}

.weather-desc {
font-size: 0.8rem;
color: #cbd5e1;
}

.header-actions {
display: flex;
gap: 1rem;
}

/* Search Section */
.search-section {
background: rgba(30, 41, 59, 0.8);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
margin: 1rem 2rem;
backdrop-filter: blur(10px);
}

.search-container {
display: flex;
gap: 1rem;
align-items: center;
margin-bottom: 1rem;
}

.search-input {
flex: 1;
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
color: #e2e8f0;
padding: 1rem 1.5rem;
border-radius: 0.75rem;
font-family: 'Inter', sans-serif;
font-size: 1rem;
transition: all 0.3s ease;
}

.search-input:focus {
outline: none;
border-color: #3b82f6;
box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-input::placeholder {
color: #64748b;
}

.search-btn {
background: linear-gradient(45deg, #1e40af, #3b82f6);
border: 1px solid #60a5fa;
color: white;
padding: 1rem 2rem;
border-radius: 0.75rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.search-btn:hover {
background: linear-gradient(45deg, #3b82f6, #60a5fa);
box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
}

.clear-search-btn {
background: linear-gradient(45deg, #dc2626, #ef4444);
border: 1px solid #f87171;
color: white;
padding: 1rem 1.5rem;
border-radius: 0.75rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.clear-search-btn:hover {
background: linear-gradient(45deg, #ef4444, #f87171);
box-shadow: 0 0 20px rgba(248, 113, 113, 0.4);
}

.search-results {
font-family: 'Inter', sans-serif;
color: #cbd5e1;
font-size: 0.9rem;
}

.search-highlight {
background: rgba(59, 130, 246, 0.2);
border: 1px solid #3b82f6;
border-radius: 0.25rem;
padding: 0.2rem 0.4rem;
}

/* Sticky Header */
.sticky-header {
position: fixed;
top: 0;
left: 0;
right: 0;
background: linear-gradient(135deg, #1e293b, #334155);
border-bottom: 1px solid #475569;
padding: 0.75rem 1.5rem;
z-index: 1000;
backdrop-filter: blur(10px);
transform: translateY(-100%);
transition: transform 0.3s ease;
}

.sticky-header.show {
transform: translateY(0);
}

.sticky-content {
display: flex;
justify-content: space-between;
align-items: center;
max-width: 1400px;
margin: 0 auto;
gap: 1rem;
}

.sticky-company {
font-family: 'Poppins', sans-serif;
font-size: 1.2rem;
font-weight: 600;
color: #60a5fa;
}

.sticky-time {
font-family: 'Rajdhani', sans-serif;
font-size: 1rem;
font-weight: 600;
color: #10b981;
}

.sticky-weather {
font-size: 0.9rem;
color: #94a3b8;
}

.sticky-actions {
display: flex;
gap: 0.5rem;
}

.sticky-btn {
background: linear-gradient(135deg, #1e40af, #3b82f6);
border: 1px solid #60a5fa;
color: white;
text-decoration: none;
padding: 0.4rem 0.8rem;
border-radius: 0.4rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
font-size: 0.8rem;
transition: all 0.3s ease;
cursor: pointer;
}

.sticky-btn:hover {
background: linear-gradient(135deg, #3b82f6, #60a5fa);
transform: translateY(-1px);
}

/* Top Info Section */
.top-info-section {
margin-bottom: 1.5rem;
margin-top: 1.5rem;
padding: 0 1.5rem;
}

.info-cards-container {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 1.5rem;
max-width: 1400px;
margin: 0 auto;
}

.info-card {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 1.25rem;
backdrop-filter: blur(10px);
}

.info-card-title {
font-family: 'Rajdhani', sans-serif;
font-size: 1.1rem;
font-weight: 600;
color: #60a5fa;
margin-bottom: 0.75rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.info-card-content {
color: #cbd5e1;
line-height: 1.6;
font-size: 0.95rem;
}

/* Service Details and Pricing Calculator */
.service-details {
background: rgba(15, 23, 42, 0.7);
border: 1px solid #334155;
border-radius: 0.75rem;
padding: 1rem;
margin: 1rem 0;
font-size: 0.9rem;
}

.service-details-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 0.75rem;
margin-bottom: 1rem;
}

.detail-item {
display: flex;
flex-direction: column;
}

.detail-label {
font-size: 0.75rem;
color: #94a3b8;
text-transform: uppercase;
margin-bottom: 0.25rem;
}

.detail-value {
color: #e2e8f0;
font-weight: 500;
}

        .pricing-calculator {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border: 1px solid #60a5fa;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .pricing-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .pricing-info-item {
            display: flex;
            flex-direction: column;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        .pricing-info-item > div:first-child {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }

        .pricing-info-description {
            font-size: 0.8rem;
            color: #cbd5e1;
            font-style: italic;
        }

        .pricing-info-label {
            font-weight: 500;
            color: #e2e8f0;
        }

        .pricing-info-value {
            font-weight: 600;
            color: #ffffff;
        }

        .pricing-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.5rem;
        }

        .service-info-summary {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #ffffff;
            line-height: 1.4;
        }

        #defaultSchedulingTimes {
            text-align: left !important;
            line-height: 1.6;
        }

        #defaultSchedulingTimes strong {
            color: #60a5fa;
            font-weight: 600;
        }

.calculator-title {
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
color: white;
font-size: 1rem;
margin-bottom: 0.75rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.sqft-input-container {
display: flex;
gap: 0.75rem;
align-items: center;
margin-bottom: 1rem;
}

.sqft-input {
flex: 1;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 0.5rem;
padding: 0.5rem 0.75rem;
color: white;
font-family: 'Inter', sans-serif;
}

.sqft-input:focus {
outline: none;
border-color: rgba(255, 255, 255, 0.4);
box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
}

.sqft-input::placeholder {
color: rgba(255, 255, 255, 0.6);
}

.calculate-btn {
background: rgba(255, 255, 255, 0.2);
border: 1px solid rgba(255, 255, 255, 0.3);
color: white;
padding: 0.5rem 1rem;
border-radius: 0.5rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.calculate-btn:hover {
background: rgba(255, 255, 255, 0.3);
}

.pricing-result {
background: rgba(255, 255, 255, 0.1);
border-radius: 0.5rem;
padding: 0.75rem;
display: none;
}

.pricing-result.show {
display: block;
}

.pricing-display {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 0.75rem;
}

.price-display-item {
text-align: center;
}

.price-display-label {
font-size: 0.75rem;
color: rgba(255, 255, 255, 0.8);
margin-bottom: 0.25rem;
}

.price-display-value {
font-size: 1.1rem;
font-weight: 600;
color: white;
}

.sqft-range-info {
font-size: 0.8rem;
color: rgba(255, 255, 255, 0.7);
margin-top: 0.5rem;
text-align: center;
}

/* Pests Covered Section */
.pests-covered-section {
background: rgba(16, 185, 129, 0.05);
border: 1px solid rgba(16, 185, 129, 0.2);
border-radius: 0.5rem;
padding: 0.75rem;
margin: 1rem 0;
}

.pests-covered-title {
font-size: 0.8rem;
font-weight: 600;
color: #10b981;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.5rem;
}

.pests-covered-list {
color: #cbd5e1;
font-size: 0.9rem;
line-height: 1.4;
}

/* Subservices Section */
.subservices-container {
margin: 1rem 0;
}

.subservice-item {
background: rgba(15, 23, 42, 0.3);
border: 1px solid #334155;
border-radius: 0.75rem;
margin: 1rem 0;
padding: 1.25rem;
transition: all 0.3s ease;
}

.subservice-item:hover {
background: rgba(15, 23, 42, 0.5);
border-color: #475569;
}

.subservice-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.75rem;
}

.subservice-name {
font-size: 1.1rem;
font-weight: 600;
color: #94a3b8;
margin: 0;
}

.subservice-frequency {
background: rgba(59, 130, 246, 0.1);
border: 1px solid rgba(59, 130, 246, 0.3);
border-radius: 0.4rem;
padding: 0.2rem 0.6rem;
font-size: 0.75rem;
font-weight: 600;
color: #60a5fa;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.subservice-description {
color: #cbd5e1;
font-size: 0.9rem;
margin-bottom: 0.75rem;
line-height: 1.4;
}

.subservice-pests {
background: rgba(16, 185, 129, 0.03);
border: 1px solid rgba(16, 185, 129, 0.15);
border-radius: 0.4rem;
padding: 0.5rem;
margin-bottom: 0.75rem;
}

.subservice-pests-title {
font-size: 0.7rem;
font-weight: 600;
color: #10b981;
text-transform: uppercase;
letter-spacing: 0.3px;
margin-bottom: 0.3rem;
}

.subservice-pests-list {
color: #94a3b8;
font-size: 0.8rem;
line-height: 1.3;
}

/* Agent Notes */
.agent-note {
background: rgba(251, 191, 36, 0.1);
border: 1px solid rgba(251, 191, 36, 0.3);
border-radius: 0.5rem;
padding: 0.75rem;
margin: 1rem 0;
}

.agent-note-title {
font-size: 0.8rem;
font-weight: 600;
color: #fbbf24;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.agent-note-title::before {
content: "‚ö†Ô∏è";
}

.agent-note-content {
color: #fde68a;
font-size: 0.9rem;
line-height: 1.4;
font-style: italic;
}

.subservice-details {
background: rgba(15, 23, 42, 0.4);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
margin: 0.75rem 0;
font-size: 0.85rem;
}

.subservice-details-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 0.5rem;
}

.subservice-detail-item {
display: flex;
flex-direction: column;
}

.subservice-detail-label {
font-size: 0.7rem;
color: #94a3b8;
text-transform: uppercase;
margin-bottom: 0.2rem;
}

.subservice-detail-value {
color: #cbd5e1;
font-weight: 500;
font-size: 0.8rem;
}

/* Pests Not Covered Alert */
.pests-not-covered-alert {
background: rgba(239, 68, 68, 0.1);
border: 1px solid #ef4444;
border-radius: 1rem;
padding: 1rem;
margin: 1rem 2rem;
display: none;
}

.pests-not-covered-alert.show {
display: block;
}

.alert-title {
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
color: #f87171;
font-size: 1.1rem;
margin-bottom: 0.5rem;
}

.alert-content {
color: #fecaca;
font-size: 0.9rem;
}

.cyber-btn {
background: linear-gradient(45deg, #1e40af, #3b82f6);
border: 1px solid #60a5fa;
color: white;
padding: 0.75rem 1.5rem;
border-radius: 0.5rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
text-decoration: none;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.cyber-btn:hover {
background: linear-gradient(45deg, #3b82f6, #60a5fa);
box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
transform: translateY(-2px);
}

/* Main Layout */
.main-container {
display: grid;
grid-template-columns: 200px 1fr 300px;
gap: 2rem;
padding: 2rem;
max-width: 1600px;
margin: 0 auto;
min-height: calc(100vh - 120px);
}

/* Navigation Sidebar */
.nav-sidebar {
background: rgba(30, 41, 59, 0.8);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
height: fit-content;
max-height: calc(100vh - 100px);
overflow-y: auto;
backdrop-filter: blur(10px);
position: sticky;
top: 20px;
transition: top 0.3s ease;
}

/* Sidebar positioning when sticky header is shown */
.nav-sidebar.sticky-header-active {
top: 90px;
max-height: calc(100vh - 170px);
}

.nav-btn {
display: block;
width: 100%;
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
color: #e2e8f0;
padding: 1rem;
margin-bottom: 0.75rem;
border-radius: 0.75rem;
font-family: 'Inter', sans-serif;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
text-align: left;
}

.nav-btn:hover {
background: linear-gradient(135deg, #334155, #475569);
border-color: #3b82f6;
color: #60a5fa;
transform: translateX(5px);
}

.nav-btn.active {
background: linear-gradient(135deg, #1e40af, #3b82f6);
border-color: #60a5fa;
color: white;
}

/* Content Area */
.content-area {
background: rgba(30, 41, 59, 0.6);
border: 1px solid #334155;
border-radius: 1rem;
padding: 2rem;
backdrop-filter: blur(10px);
}

.content-section {
display: none;
}

.content-section.active {
display: block;
}

.services-grid {
display: grid;
gap: 1.5rem;
}

.service-card {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 1.5rem;
transition: all 0.3s ease;
position: relative;
}

.service-card:hover {
border-color: #3b82f6;
box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
transform: translateY(-2px);
}

.service-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 0.75rem;
}

.service-name {
font-size: 1.25rem;
font-weight: 600;
color: #60a5fa;
margin: 0;
flex: 1;
}

.service-frequency {
background: rgba(16, 185, 129, 0.1);
border: 1px solid rgba(16, 185, 129, 0.3);
border-radius: 0.5rem;
padding: 0.25rem 0.75rem;
font-size: 0.8rem;
font-weight: 600;
color: #10b981;
text-transform: uppercase;
letter-spacing: 0.5px;
white-space: nowrap;
margin-left: 1rem;
}

.service-description {
color: #cbd5e1;
margin-bottom: 1rem;
line-height: 1.6;
}

.service-pricing {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
gap: 0.75rem;
margin-top: 1rem;
}

.price-item {
background: rgba(15, 23, 42, 0.5);
padding: 0.5rem;
border-radius: 0.5rem;
border: 1px solid #334155;
}

.price-label {
font-size: 0.7rem;
color: #94a3b8;
text-transform: uppercase;
margin-bottom: 0.25rem;
}

.price-value {
font-weight: 600;
color: #10b981;
font-size: 0.9rem;
}

/* Tools Sidebar */
.tools-sidebar {
background: rgba(30, 41, 59, 0.8);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
height: fit-content;
max-height: calc(100vh - 100px);
overflow-y: auto;
backdrop-filter: blur(10px);
position: sticky;
top: 20px;
transition: top 0.3s ease;
}

/* Sidebar positioning when sticky header is shown */
.tools-sidebar.sticky-header-active {
top: 90px;
max-height: calc(100vh - 170px);
}

.tool-section {
margin-bottom: 2rem;
position: relative;
}

.tool-title {
font-family: 'Rajdhani', sans-serif;
font-size: 1.1rem;
font-weight: 600;
color: #60a5fa;
margin-bottom: 1rem;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.tool-input {
width: 100%;
background: rgba(15, 23, 42, 0.7);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
color: #e2e8f0;
font-family: 'Inter', sans-serif;
margin-bottom: 0.75rem;
}

.tool-input:focus {
outline: none;
border-color: #3b82f6;
box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-popup {
position: absolute;
top: 4.5rem;
left: 0;
right: 0;
z-index: 1000;
background: rgba(15, 23, 42, 0.95);
border: 1px solid #3b82f6;
border-radius: 0.75rem;
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(59, 130, 246, 0.2);
backdrop-filter: blur(10px);
max-height: 300px;
overflow-y: auto;
animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
from {
opacity: 0;
transform: translateY(-10px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.search-popup-content {
padding: 1rem;
}

.search-popup-header {
font-size: 0.9rem;
font-weight: 600;
color: #60a5fa;
margin-bottom: 0.75rem;
}

.search-popup-item {
padding: 0.75rem;
border-radius: 0.5rem;
margin-bottom: 0.5rem;
cursor: pointer;
transition: all 0.2s ease;
border: 1px solid transparent;
}

.search-popup-item:hover {
background: rgba(59, 130, 246, 0.2);
border-color: #3b82f6;
transform: translateX(2px);
}

.search-popup-item.covered {
background: rgba(16, 185, 129, 0.1);
border-color: rgba(16, 185, 129, 0.3);
}

.search-popup-item.not-covered {
background: rgba(239, 68, 68, 0.1);
border-color: rgba(239, 68, 68, 0.3);
}

.search-popup-item.warning {
background: rgba(251, 191, 36, 0.1);
border-color: rgba(251, 191, 36, 0.3);
}

.search-popup-item-icon {
display: inline-block;
width: 20px;
font-weight: bold;
}

.search-popup-item-text {
color: #e2e8f0;
}

.search-popup-item-detail {
font-size: 0.8rem;
color: #94a3b8;
margin-top: 0.25rem;
}

.tool-btn {
width: 100%;
background: linear-gradient(135deg, #1e40af, #3b82f6);
border: none;
color: white;
padding: 0.75rem;
border-radius: 0.5rem;
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-bottom: 0.75rem;
}

.tool-btn:hover {
background: linear-gradient(135deg, #3b82f6, #60a5fa);
transform: translateY(-1px);
}

.tool-result {
background: rgba(15, 23, 42, 0.5);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
color: #10b981;
font-weight: 500;
min-height: 2.5rem;
display: flex;
align-items: center;
}

.time-display {
background: rgba(15, 23, 42, 0.7);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
margin-bottom: 0.5rem;
display: flex;
justify-content: space-between;
align-items: center;
}

.time-zone {
font-family: 'Rajdhani', sans-serif;
font-weight: 600;
color: #94a3b8;
}

.time-value {
font-family: monospace;
color: #60a5fa;
font-weight: 600;
}

/* Bulletin and Pests Not Covered */
.info-section {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 1.5rem;
margin-bottom: 1.5rem;
}

.info-title {
font-family: 'Rajdhani', sans-serif;
font-size: 1.25rem;
font-weight: 600;
color: #60a5fa;
margin-bottom: 1rem;
}

.info-content {
color: #cbd5e1;
line-height: 1.6;
white-space: pre-line;
}

/* Office Info Modal */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
}

.modal-content {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 2rem;
max-width: 500px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1.5rem;
}

.modal-title {
font-family: 'Rajdhani', sans-serif;
font-size: 1.5rem;
font-weight: 600;
color: #60a5fa;
}

.close-btn {
background: none;
border: none;
color: #94a3b8;
font-size: 1.5rem;
cursor: pointer;
padding: 0.25rem;
}

.close-btn:hover {
color: #e2e8f0;
}

.office-info {
display: grid;
gap: 1rem;
}

.office-item {
display: flex;
justify-content: space-between;
align-items: flex-start;
padding: 0.75rem;
background: rgba(15, 23, 42, 0.5);
border-radius: 0.5rem;
border: 1px solid #334155;
}

.office-label {
font-weight: 600;
color: #94a3b8;
margin-right: 1rem;
}

.office-value {
color: #e2e8f0;
text-align: right;
white-space: pre-line;
}

/* Loading States */
.loading {
text-align: center;
padding: 3rem;
color: #94a3b8;
font-size: 1.1rem;
}

.error {
text-align: center;
padding: 3rem;
color: #ef4444;
font-size: 1.1rem;
}

/* Responsive Design */
@media (max-width: 1200px) {
.main-container {
grid-template-columns: 180px 1fr 250px;
gap: 1.5rem;
padding: 1.5rem;
}
}

@media (max-width: 768px) {
.main-container {
grid-template-columns: 1fr;
gap: 1rem;
padding: 1rem;
}

.header-content {
flex-direction: column;
gap: 1rem;
text-align: center;
}

.time-weather-container {
flex-direction: column;
}

.header-actions {
flex-wrap: wrap;
justify-content: center;
}

.company-info h1 {
font-size: 2rem;
}

.info-cards-container {
grid-template-columns: 1fr;
}

.sticky-content {
flex-wrap: wrap;
justify-content: center;
text-align: center;
}

.sticky-actions {
order: -1;
width: 100%;
justify-content: center;
margin-bottom: 0.5rem;
}
}

/* Organized Policies Layout */
.policies-container {
display: flex;
gap: 1.5rem;
min-height: 500px;
}

.policies-sidebar {
width: 250px;
background: rgba(30, 41, 59, 0.8);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
backdrop-filter: blur(10px);
}

.policies-main {
flex: 1;
background: rgba(30, 41, 59, 0.6);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
backdrop-filter: blur(10px);
}

.policy-group-btn {
display: block;
width: 100%;
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
color: #e2e8f0;
padding: 0.75rem 1rem;
margin-bottom: 0.5rem;
border-radius: 0.5rem;
font-family: 'Inter', sans-serif;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
text-align: left;
font-size: 0.9rem;
}

.policy-group-btn:hover {
background: linear-gradient(135deg, #334155, #475569);
border-color: #3b82f6;
color: #60a5fa;
transform: translateX(3px);
}

.policy-group-btn.active {
background: linear-gradient(135deg, #1e40af, #3b82f6);
border-color: #60a5fa;
color: white;
}

.policy-group-content {
display: none;
}

.policy-group-content.active {
display: block;
}

.policy-group-title {
color: #60a5fa;
font-size: 1.4rem;
font-weight: 600;
margin-bottom: 1rem;
padding-bottom: 0.5rem;
border-bottom: 2px solid #334155;
}

.policy-item {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 0.75rem;
padding: 1.25rem;
margin-bottom: 1rem;
transition: all 0.3s ease;
}

.policy-item:hover {
border-color: #3b82f6;
transform: translateY(-2px);
box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
}

.policy-item-title {
color: #e2e8f0;
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 0.5rem;
}

.policy-item-description {
color: #94a3b8;
line-height: 1.6;
margin-bottom: 1rem;
}

.policy-details {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 0.75rem;
}

.policy-detail {
background: rgba(15, 23, 42, 0.6);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
}

.policy-detail-label {
color: #60a5fa;
font-size: 0.8rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.25rem;
}

.policy-detail-value {
color: #e2e8f0;
font-weight: 500;
}

@media (max-width: 768px) {
.policies-container {
flex-direction: column;
}

.policies-sidebar {
width: 100%;
}

.policy-details {
grid-template-columns: 1fr;
}
}

/* Scheduling Interface Styles */
.scheduling-container {
padding: 1.5rem;
}

.scheduling-header {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 1.5rem;
margin-bottom: 1.5rem;
}

.scheduling-title {
color: #e2e8f0;
font-size: 1.8rem;
font-weight: 700;
margin-bottom: 1rem;
text-align: center;
}

.scheduling-quick-tools {
display: flex;
gap: 1rem;
justify-content: center;
flex-wrap: wrap;
}

.scheduling-tool {
display: flex;
gap: 0.5rem;
align-items: center;
}

.scheduling-input, .scheduling-select {
background: rgba(15, 23, 42, 0.8);
border: 1px solid #475569;
border-radius: 0.5rem;
color: #e2e8f0;
padding: 0.75rem;
font-size: 0.9rem;
width: 140px;
transition: all 0.3s ease;
}

.scheduling-input:focus, .scheduling-select:focus {
outline: none;
border-color: #3b82f6;
box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.scheduling-btn {
background: linear-gradient(135deg, #3b82f6, #1d4ed8);
border: 1px solid #2563eb;
border-radius: 0.5rem;
color: white;
padding: 0.75rem 1rem;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
white-space: nowrap;
}

.scheduling-btn:hover {
background: linear-gradient(135deg, #2563eb, #1e40af);
transform: translateY(-1px);
box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.scheduling-policies {
background: linear-gradient(135deg, #0f172a, #1e293b);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.25rem;
margin-bottom: 1.5rem;
}

.policy-quick-ref {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 1rem;
}

.policy-item-compact {
background: rgba(30, 41, 59, 0.6);
border: 1px solid #475569;
border-radius: 0.5rem;
padding: 1rem;
text-align: center;
transition: all 0.3s ease;
}

.policy-item-compact:hover {
border-color: #3b82f6;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.policy-label {
color: #60a5fa;
font-size: 0.8rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.5rem;
}

.policy-value {
color: #e2e8f0;
font-weight: 500;
font-size: 0.9rem;
}

.tech-search-results {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #3b82f6;
border-radius: 1rem;
margin-bottom: 1.5rem;
overflow: hidden;
box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
}

.search-results-header {
background: linear-gradient(135deg, #3b82f6, #1d4ed8);
padding: 1rem 1.5rem;
display: flex;
justify-content: space-between;
align-items: center;
}

.search-results-header h3 {
color: white;
margin: 0;
font-size: 1.2rem;
font-weight: 600;
}

.close-search-btn {
background: rgba(255, 255, 255, 0.2);
border: 1px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
color: white;
width: 30px;
height: 30px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 1.2rem;
font-weight: bold;
transition: all 0.3s ease;
}

.close-search-btn:hover {
background: rgba(255, 255, 255, 0.3);
transform: scale(1.1);
}

.search-results-content {
padding: 1.5rem;
}

.technicians-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
gap: 1.5rem;
}

.tech-card {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 1rem;
padding: 1.5rem;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.tech-card:hover {
border-color: #3b82f6;
transform: translateY(-4px);
box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
}

.tech-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 4px;
background: linear-gradient(90deg, #3b82f6, #06b6d4, #10b981);
}

.tech-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 1rem;
}

.tech-name {
color: #e2e8f0;
font-size: 1.3rem;
font-weight: 700;
margin: 0;
}

.tech-role-badge {
background: linear-gradient(135deg, #059669, #10b981);
color: white;
padding: 0.25rem 0.75rem;
border-radius: 1rem;
font-size: 0.8rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.tech-role-badge.inspector {
background: linear-gradient(135deg, #7c3aed, #a855f7);
}

.tech-role-badge.both {
background: linear-gradient(135deg, #dc2626, #ef4444);
}

.tech-company {
color: #94a3b8;
font-size: 0.9rem;
font-weight: 500;
margin-bottom: 1rem;
}

.tech-details {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 0.75rem;
margin-bottom: 1rem;
}

.tech-detail {
background: rgba(15, 23, 42, 0.6);
border: 1px solid #334155;
border-radius: 0.5rem;
padding: 0.75rem;
}

.tech-detail-label {
color: #60a5fa;
font-size: 0.75rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.25rem;
}

.tech-detail-value {
color: #e2e8f0;
font-weight: 500;
font-size: 0.9rem;
}

.tech-schedule {
background: rgba(59, 130, 246, 0.1);
border: 1px solid #3b82f6;
border-radius: 0.75rem;
padding: 1rem;
margin-bottom: 1rem;
}

.tech-schedule-title {
color: #60a5fa;
font-size: 0.9rem;
font-weight: 600;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.tech-schedule-value {
color: #e2e8f0;
font-weight: 500;
line-height: 1.4;
}

.tech-restrictions {
background: rgba(239, 68, 68, 0.1);
border: 1px solid #ef4444;
border-radius: 0.75rem;
padding: 1rem;
margin-bottom: 1rem;
}

.tech-restrictions-title {
color: #f87171;
font-size: 0.9rem;
font-weight: 600;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.tech-restrictions-value {
color: #fca5a5;
font-weight: 500;
line-height: 1.4;
}

.tech-notes {
background: rgba(16, 185, 129, 0.1);
border: 1px solid #10b981;
border-radius: 0.75rem;
padding: 1rem;
}

.tech-notes-title {
color: #34d399;
font-size: 0.9rem;
font-weight: 600;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.tech-notes-value {
color: #6ee7b7;
font-weight: 500;
line-height: 1.4;
}

.zip-coverage-list {
display: flex;
flex-wrap: wrap;
gap: 0.25rem;
margin-top: 0.5rem;
}

.zip-badge {
background: rgba(59, 130, 246, 0.2);
border: 1px solid #3b82f6;
color: #60a5fa;
padding: 0.25rem 0.5rem;
border-radius: 0.25rem;
font-size: 0.75rem;
font-weight: 500;
}

/* Service Policies Section */
.service-policies-section {
background: linear-gradient(135deg, #0f172a, #1e293b);
border: 1px solid #334155;
border-radius: 1rem;
padding: 1.5rem;
margin-bottom: 1.5rem;
}

.service-policies-header {
text-align: center;
margin-bottom: 1.5rem;
}

.service-policies-title {
color: #e2e8f0;
font-size: 1.4rem;
font-weight: 700;
margin: 0 0 0.5rem 0;
display: flex;
align-items: center;
justify-content: center;
gap: 0.5rem;
}

.service-policies-subtitle {
color: #94a3b8;
font-size: 0.9rem;
font-weight: 500;
margin-bottom: 1rem;
}

.toggle-policies-btn {
background: rgba(59, 130, 246, 0.1);
border: 1px solid #3b82f6;
border-radius: 0.5rem;
color: #60a5fa;
padding: 0.5rem 1rem;
font-size: 0.85rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 0.5rem;
}

.toggle-policies-btn:hover {
background: rgba(59, 130, 246, 0.2);
border-color: #60a5fa;
transform: translateY(-1px);
}

.toggle-icon {
transition: transform 0.3s ease;
font-size: 0.75rem;
}

.toggle-icon.rotated {
transform: rotate(180deg);
}

.service-policies-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
gap: 1.25rem;
}

.service-policy-card {
background: linear-gradient(135deg, #1e293b, #334155);
border: 1px solid #475569;
border-radius: 0.875rem;
padding: 1.25rem;
display: flex;
align-items: flex-start;
gap: 1rem;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.service-policy-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 3px;
background: linear-gradient(90deg, #3b82f6, #06b6d4, #10b981);
}

.service-policy-card:hover {
border-color: #3b82f6;
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
}

.service-policy-icon {
font-size: 1.8rem;
line-height: 1;
flex-shrink: 0;
background: rgba(59, 130, 246, 0.1);
border: 1px solid #3b82f6;
border-radius: 0.75rem;
width: 3rem;
height: 3rem;
display: flex;
align-items: center;
justify-content: center;
}

.service-policy-content {
flex: 1;
}

.service-policy-title {
color: #e2e8f0;
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 0.5rem;
}

.service-policy-description {
color: #94a3b8;
font-size: 0.85rem;
line-height: 1.4;
margin-bottom: 0.75rem;
}

.service-policy-value {
color: #60a5fa;
font-size: 0.95rem;
font-weight: 600;
background: rgba(59, 130, 246, 0.1);
border: 1px solid rgba(59, 130, 246, 0.3);
border-radius: 0.5rem;
padding: 0.5rem 0.75rem;
display: inline-block;
}

/* Enhanced Reservices Card Styling */
.reservices-card {
grid-column: 1 / -1;
max-width: none;
}

.reservices-settings {
display: flex;
flex-direction: column;
gap: 1rem;
}

.reservices-setting {
display: flex;
justify-content: space-between;
align-items: center;
background: rgba(59, 130, 246, 0.05);
border: 1px solid rgba(59, 130, 246, 0.2);
border-radius: 0.5rem;
padding: 0.75rem 1rem;
}

.setting-label {
color: #94a3b8;
font-size: 0.9rem;
font-weight: 500;
}

.setting-value {
color: #60a5fa;
font-size: 0.95rem;
font-weight: 700;
background: rgba(59, 130, 246, 0.15);
border: 1px solid #3b82f6;
border-radius: 0.375rem;
padding: 0.375rem 0.75rem;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.reservices-policy {
background: rgba(16, 185, 129, 0.08);
border: 1px solid rgba(16, 185, 129, 0.2);
border-radius: 0.5rem;
padding: 1rem;
margin-top: 0.75rem;
}

.policy-note-title {
color: #34d399;
font-size: 0.85rem;
font-weight: 600;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.policy-note-content {
color: #94a3b8;
font-size: 0.85rem;
line-height: 1.5;
}

@media (max-width: 1024px) {
.reservices-card {
grid-column: 1 / -1;
}

.reservices-setting {
flex-direction: column;
align-items: flex-start;
gap: 0.5rem;
}

.setting-value {
align-self: stretch;
text-align: center;
}
}

@media (max-width: 768px) {
.scheduling-quick-tools {
flex-direction: column;
align-items: stretch;
}

.scheduling-tool {
justify-content: stretch;
}

.scheduling-input, .scheduling-select {
width: 100%;
}

.policy-quick-ref {
grid-template-columns: 1fr;
}

.service-policies-grid {
grid-template-columns: 1fr;
}

.technicians-grid {
grid-template-columns: 1fr;
}

.tech-details {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="company-info">
                <h1 id="companyName">Loading...</h1>
                <div class="location">
                    <span id="locationInfo">Loading location...</span>
                </div>
            </div>
            <div class="time-weather-container">
                <div class="current-time" id="currentTime">--:-- --</div>
                <div class="weather-forecast" id="weatherForecast">
                    <div class="weather-forecast-content" id="weatherContent">
                        Loading weather...
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="#" id="websiteLink" class="cyber-btn" target="_blank">Website</a>
                <a href="#" id="fieldRoutesLink" class="cyber-btn" target="_blank">FieldRoutes</a>
                <button class="cyber-btn" onclick="openOfficeModal()">Office Info</button>
            </div>
        </div>
    </header>

    <!-- Sticky Header -->
    <header class="sticky-header" id="stickyHeader">
        <div class="sticky-content">
            <div class="sticky-company" id="stickyCompanyName">Loading...</div>
            <div class="sticky-time" id="stickyTime">--:-- --</div>
            <div class="sticky-weather" id="stickyWeather">Loading...</div>
            <div class="sticky-actions">
                <a href="#" id="stickyWebsiteLink" class="sticky-btn" target="_blank">Website</a>
                <a href="#" id="stickyFieldRoutesLink" class="sticky-btn" target="_blank">Routes</a>
                <button class="sticky-btn" onclick="openOfficeModal()">Info</button>
            </div>
        </div>
    </header>

    <!-- Top Info Section -->
    <div class="top-info-section">
        <div class="info-cards-container">
            <div class="info-card">
                <div class="info-card-title">üì¢ Company Bulletin</div>
                <div class="info-card-content" id="topBulletinContent">Loading bulletin...</div>
            </div>
            <div class="info-card">
                <div class="info-card-title">üö´ Pests Not Covered</div>
                <div class="info-card-content" id="topPestsNotCoveredContent">Loading exclusions...</div>
            </div>
        </div>
    </div>

    <!-- Pests Not Covered Alert -->
    <div class="pests-not-covered-alert" id="pestsNotCoveredAlert">
        <div class="alert-title">‚ö†Ô∏è Pest Not Covered</div>
        <div class="alert-content" id="alertContent"></div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Navigation Sidebar -->
        <nav class="nav-sidebar">
            <button class="nav-btn active" onclick="showSection('services')">Services</button>
            <button class="nav-btn" onclick="showSection('policies')">Policies</button>
            <button class="nav-btn" onclick="showSection('technicians')">Scheduling</button>
            <button class="nav-btn" onclick="showSection('bulletin')">Bulletin</button>
        </nav>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Loading State -->
            <div id="loadingState" class="loading">
                <div>Loading client profile...</div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error" style="display: none;">
                <div>Error loading profile data</div>
            </div>

            <!-- Services Section -->
            <div id="servicesSection" class="content-section">
                <div id="servicesGrid" class="services-grid">
                    <!-- Services will be populated here -->
                </div>
            </div>

            <!-- Technicians Section -->
            <div id="techniciansSection" class="content-section">
                <div class="scheduling-container">
                    <!-- Scheduling Tools Header -->
                    <div class="scheduling-header">
                        <h2 class="scheduling-title">üìã Scheduling & Technician Management</h2>
                        <div class="scheduling-quick-tools">
                            <div class="scheduling-tool">
                                <input type="text" class="scheduling-input" id="zipLookup" placeholder="Enter ZIP code" maxlength="5">
                                <button class="scheduling-btn" onclick="findTechByZip()">Find Tech by ZIP</button>
                            </div>
                            <div class="scheduling-tool">
                                <select class="scheduling-select" id="serviceTypeLookup" onchange="filterByServiceType()">
                                    <option value="">All Service Types</option>
                                    <option value="inspection">Inspections Only</option>
                                    <option value="technician">Technicians Only</option>
                                    <option value="both">Both Services</option>
                                </select>
                            </div>
                            <div class="scheduling-tool">
                                <button class="scheduling-btn" onclick="showAllTechs()">Show All Techs</button>
                            </div>
                        </div>
                    </div>

                    <!-- Scheduling Policies Section -->
                    <div class="scheduling-policies">
                        <div class="policy-quick-ref">
                            <div class="policy-item-compact">
                                <div class="policy-label">Default Scheduling Windows</div>
                                <div class="policy-value" id="defaultSchedulingTimes">Loading...</div>
                            </div>
                            <div class="policy-item-compact">
                                <div class="policy-label">Max Distance</div>
                                <div class="policy-value" id="maxDistance">Loading...</div>
                            </div>
                            <div class="policy-item-compact">
                                <div class="policy-label">Same Day Services</div>
                                <div class="policy-value" id="sameDayPolicy">Loading...</div>
                            </div>
                            <div class="policy-item-compact">
                                <div class="policy-label">Appointment Confirmations</div>
                                <div class="policy-value" id="confirmationPolicy">Loading...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Policies Section -->
                    <div class="service-policies-section">
                        <div class="service-policies-header">
                            <h3 class="service-policies-title">üìã Service Policies</h3>
                            <div class="service-policies-subtitle">Key policies for scheduling and service management</div>
                            <button class="toggle-policies-btn" onclick="toggleReservicePolicies()">
                                <span class="toggle-text" id="toggleText">Show Reservice Details</span>
                                <span class="toggle-icon" id="toggleIcon">‚ñº</span>
                            </button>
                        </div>
                        <div class="service-policies-grid">
                            <div class="service-policy-card reservices-card" id="reservicesCard">
                                <div class="service-policy-icon">üîÑ</div>
                                <div class="service-policy-content">
                                    <div class="service-policy-title">Reservices Setup</div>
                                    <div class="service-policy-description">Required settings for repeat service calls within guarantee period</div>
                                    <div class="reservices-settings" id="reservicesDetails" style="display: none;">
                                        <div class="reservices-setting">
                                            <div class="setting-label">Set Service Type to:</div>
                                            <div class="setting-value" id="reservicesServiceType">Reservice</div>
                                        </div>
                                        <div class="reservices-setting">
                                            <div class="setting-label">Set Subscription to:</div>
                                            <div class="setting-value" id="reservicesSubscription">Stand-Alone Service</div>
                                        </div>
                                        <div class="reservices-policy">
                                            <div class="policy-note-title">üìñ Reservice Policy</div>
                                            <div class="policy-note-content" id="reservicesPolicy">Loading...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div class="tech-search-results" id="techSearchResults" style="display: none;">
                        <div class="search-results-header">
                            <h3>Search Results</h3>
                            <button class="close-search-btn" onclick="clearTechSearch()">√ó</button>
                        </div>
                        <div class="search-results-content" id="searchResultsContent">
                            <!-- Search results will appear here -->
                        </div>
                    </div>

                    <!-- Technicians Grid -->
                    <div id="techniciansGrid" class="technicians-grid">
                        <!-- Technicians will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Policies Section -->
            <div id="policiesSection" class="content-section">
                <div id="policiesGrid" class="services-grid">
                    <!-- Policies will be populated here -->
                </div>
            </div>

            <!-- Service Areas Section -->
            <div id="serviceAreasSection" class="content-section">
                <div id="serviceAreasGrid" class="services-grid">
                    <!-- Service areas will be populated here -->
                </div>
            </div>

            <!-- Bulletin Section -->
            <div id="bulletinSection" class="content-section">
                <div class="info-section">
                    <h2 class="info-title">Company Bulletin</h2>
                    <div class="info-content" id="bulletinContent">
                        <!-- Bulletin content will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Pests Not Covered Section -->
            <div id="pestsNotCoveredSection" class="content-section">
                <div class="info-section">
                    <h2 class="info-title">Pests Not Covered</h2>
                    <div class="info-content" id="pestsNotCoveredContent">
                        <!-- Pests not covered content will be populated here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Tools Sidebar -->
        <aside class="tools-sidebar">
            <!-- Pest Search -->
            <div class="tool-section">
                <div class="tool-title">Pest Search</div>
<input type="text" class="tool-input" id="pestSearch" placeholder="Enter pest name" maxlength="50">
                <button class="tool-btn" onclick="searchPests()">Search</button>
                <button class="tool-btn" onclick="clearSearch()" style="background: linear-gradient(135deg, #64748b, #94a3b8);">Clear</button>
<div class="tool-result" id="pestSearchResult">Enter pest name to search</div>

<!-- Search Results Popup -->
<div class="search-popup" id="searchPopup" style="display: none;">
<div class="search-popup-content" id="searchPopupContent">
<!-- Search results will appear here -->
</div>
</div>
            </div>

            <!-- Service Area Check -->
            <div class="tool-section">
                <div class="tool-title">Service Area Check</div>
                <input type="text" class="tool-input" id="zipInput" placeholder="Enter ZIP code" maxlength="5">
                <button class="tool-btn" onclick="checkZip()">Check Area</button>
                <div class="tool-result" id="zipResult">Enter ZIP to check</div>
            </div>

            <!-- Acreage Converter -->
            <div class="tool-section">
                <div class="tool-title">Acreage Converter</div>
                <input type="number" class="tool-input" id="acresInput" placeholder="Enter acres" step="0.01">
                <button class="tool-btn" onclick="convertAcres()">Convert to Sq Ft</button>
                <div class="tool-result" id="conversionResult">Enter acres to convert</div>
            </div>
        </aside>

    <!-- Office Info Modal -->
    <div id="officeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Office Information</h3>
                <button class="close-btn" onclick="closeOfficeModal()">&times;</button>
            </div>
            <div class="office-info" id="officeInfo">
                <!-- Office information will be populated here -->
            </div>
        </div>
    </div>

<script src="config-github.js"></script>
<script>
let clientData = {};

// Load profile data from Apps Script API
async function loadProfileData() {
    const profileId = getProfileIdFromUrl();

    if (!profileId) {
        showError('No profile ID provided in URL');
        return;
    }

    try {
        const apiUrl = window.CONFIG?.GOOGLE_SHEETS?.WEB_APP_URL;
        if (!apiUrl) {
            throw new Error('API URL not configured');
        }

        console.log('üìä Fetching data from Apps Script API...');
        console.log('üîó URL:', apiUrl);
        console.log('üîç Looking for Profile ID:', profileId);

        const response = await fetch(`${apiUrl}?profileId=${encodeURIComponent(profileId)}`);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log('‚úÖ Data received from Apps Script:', data);

        if (data.error) {
            throw new Error(data.error);
        }

        clientData = data;
        populateClientData();
        updateCurrentTime(clientData.timezone);
        setInterval(() => updateCurrentTime(clientData.timezone), 60000);

    } catch (error) {
        console.error('Error loading profile:', error);
        showError('Error loading profile data: ' + error.message);
    }
}

function getProfileIdFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('profileId');
}

function showError(message) {
    const loadingEl = document.getElementById('loadingState');
    if (loadingEl) loadingEl.style.display = 'none';
    
    const errorEl = document.getElementById('errorState');
    if (errorEl) {
        errorEl.style.display = 'block';
        errorEl.innerHTML = `<div>Error: ${message}</div>`;
} else {
        console.error('Error:', message);
        alert('Error: ' + message);
    }

// If no profile ID provided, show sample data
if (!getProfileIdFromUrl()) {
clientData = {
companyName: "SOS Exterminating",
location: "Dallas, TX",
timezone: "Central",
officeInfo: {
phone: "(214) 555-4567",
email: "dallas@sosexterminating.com",
website: "https://sosexterminating.com",
fieldRoutesLink: "https://fieldroutes.com",
physicalAddress: "123 Main Street\nDallas, TX 75201",
officeHours: "Monday-Friday: 8 AM - 5 PM"
},
bulletin: "This is test data - no Wix connection detected",
pestsNotCovered: "Carpenter Ants, Bed Bugs, Termites (requires separate treatment)",
services: [{
name: "General Pest Control",
description: "Comprehensive pest control service with multiple frequency options to meet your specific needs",
serviceType: "General Pest Control",
queueExt: "6884",
productType: "General Pest Control",
contract: "12 Months",
guarantee: "90-day guarantee",
duration: "45 minutes",
billingFrequency: "After service completion",
agentNote: "IMPORTANT: Always confirm property square footage before quoting. Ask about previous pest issues to recommend appropriate frequency.",
subServices: [
{
name: "Monthly GPC",
frequency: "Monthly",
description: "Premium monthly pest control for maximum protection year-round",
pests: "Ants, Roaches, Spiders, Crickets, Silverfish, Earwigs, Pill Bugs",
contract: "12 Months",
guarantee: "90-day guarantee",
duration: "45-60 minutes",
serviceType: "Monthly GPC",
productType: "General Pest Control - Monthly",
billingFrequency: "Monthly after service",
agentNote: "Monthly service recommended for high pest pressure areas or customers with pest phobia. Emphasize year-round protection.",
pricingTiers: [
{
sqftMin: 0,
sqftMax: 2500,
firstPrice: "$135.00",
recurringPrice: "$130.00",
serviceType: "Monthly GPC"
},
{
sqftMin: 2501,
sqftMax: 3000,
firstPrice: "$145.00",
recurringPrice: "$140.00",
serviceType: "Monthly GPC"
},
{
sqftMin: 3001,
sqftMax: 4000,
firstPrice: "$155.00",
recurringPrice: "$150.00",
serviceType: "Monthly GPC"
},
{
sqftMin: 4001,
sqftMax: 999999,
firstPrice: "Requires Client Follow-Up",
recurringPrice: "",
serviceType: "Monthly GPC"
}
]
},
{
name: "Quarterly GPC",
frequency: "Quarterly",
description: "Standard quarterly pest control service with seasonal treatments",
pests: "Ants, Roaches, Spiders, Crickets, Silverfish",
contract: "12 Months",
guarantee: "90-day guarantee",
duration: "45 minutes",
serviceType: "Quarterly GPC",
productType: "General Pest Control - Quarterly",
billingFrequency: "Quarterly after service",
agentNote: "Most popular option. Good for moderate pest pressure. Remind customers about seasonal variations in pest activity.",
pricingTiers: [
{
sqftMin: 0,
sqftMax: 2500,
firstPrice: "$125.00",
recurringPrice: "$120.00",
serviceType: "Quarterly GPC"
},
{
sqftMin: 2501,
sqftMax: 3000,
firstPrice: "$130.00",
recurringPrice: "$125.00",
serviceType: "Quarterly GPC"
},
{
sqftMin: 3001,
sqftMax: 4000,
firstPrice: "$140.00",
recurringPrice: "$135.00",
serviceType: "Quarterly GPC"
},
{
sqftMin: 4001,
sqftMax: 999999,
firstPrice: "Requires Client Follow-Up",
recurringPrice: "",
serviceType: "Quarterly GPC"
}
]
},
{
name: "Bi-Monthly GPC",
frequency: "Bi-Monthly",
description: "Enhanced bi-monthly service for moderate to high pest pressure areas",
pests: "Ants, Roaches, Spiders, Crickets, Silverfish, Centipedes",
contract: "12 Months",
guarantee: "90-day guarantee",
duration: "45-50 minutes",
serviceType: "Bi-Monthly GPC",
productType: "General Pest Control - Bi-Monthly",
billingFrequency: "Bi-monthly after service",
agentNote: "Good middle-ground option. Recommend for customers who want more than quarterly but find monthly excessive.",
pricingTiers: [
{
sqftMin: 0,
sqftMax: 2500,
firstPrice: "$130.00",
recurringPrice: "$125.00",
serviceType: "Bi-Monthly GPC"
},
{
sqftMin: 2501,
sqftMax: 3000,
firstPrice: "$138.00",
recurringPrice: "$133.00",
serviceType: "Bi-Monthly GPC"
},
{
sqftMin: 3001,
sqftMax: 4000,
firstPrice: "$148.00",
recurringPrice: "$143.00",
serviceType: "Bi-Monthly GPC"
},
{
sqftMin: 4001,
sqftMax: 999999,
firstPrice: "Requires Client Follow-Up",
recurringPrice: "",
serviceType: "Bi-Monthly GPC"
}
]
}
]
}, {
name: "Monthly Mosquito Service",
description: "Monthly mosquito, flea, and tick control",
contract: "Seasonal",
guarantee: "30-day guarantee",
duration: "30 minutes",
pests: "Mosquitoes, Fleas, Ticks",
serviceType: "Monthly Mosquito",
queueExt: "6884",
productType: "Mosquito - Flea - Tick",
frequency: "Monthly",
billingFrequency: "After service completion",
agentNote: "Seasonal service typically runs April through October. Emphasize outdoor living enhancement and tick disease prevention.",
pricingTiers: [
{
sqftMin: 0,
sqftMax: 10890,
firstPrice: "$108.00",
recurringPrice: "$108.00",
serviceType: "Monthly Mosquito"
},
{
sqftMin: 10891,
sqftMax: 21780,
firstPrice: "$120.00",
recurringPrice: "$118.00",
serviceType: "Monthly Mosquito"
},
{
sqftMin: 21781,
sqftMax: 32680,
firstPrice: "$132.00",
recurringPrice: "$128.00",
serviceType: "Monthly Mosquito"
},
{
sqftMin: 32681,
sqftMax: 43560,
firstPrice: "$144.00",
recurringPrice: "$138.00",
serviceType: "Monthly Mosquito"
},
{
sqftMin: 43561,
sqftMax: 999999,
firstPrice: "Requires Client Follow-Up",
recurringPrice: "",
serviceType: "Monthly Mosquito"
}
]
}],
technicians: [{
name: "John Smith",
company: "SOS Exterminating",
role: "Both",
phone: "(214) 555-0001",
schedule: "Mon-Fri 8-5 Saturday 8-12",
maxStops: "12",
doesNotService: "",
additionalNotes: "Preferred technician for North Dallas area",
zipCodes: ["75001", "75002", "75010", "75011"]
}, {
name: "Sarah Johnson", 
company: "SOS Exterminating",
role: "Inspector",
phone: "(214) 555-0002",
schedule: "Mon-Fri 9-4",
maxStops: "8",
doesNotService: "Does not service regular services ‚Äì schedule inspections only",
additionalNotes: "Commercial inspections specialist",
zipCodes: ["75001", "75002", "75020", "75021"]
}, {
name: "Mike Wilson",
company: "SOS Exterminating", 
role: "Technician",
phone: "(214) 555-0003",
schedule: "Mon-Thur 8-5, Fri 8-3",
maxStops: "10",
doesNotService: "Termite, Mosquito/Tick",
additionalNotes: "Covers weekend emergency calls",
zipCodes: ["75030", "75031", "75040", "75041"]
}],
policies: {
"Service Coverage": [
{
type: "vehicles",
title: "Do we treat vehicles",
description: "Policy regarding pest control services for vehicles and automotive properties.",
options: ["Yes", "No", "Case by case"],
default: "No"
},
{
type: "commercial",
title: "Commercial Properties",
description: "Availability of pest control services for commercial and business properties.",
options: ["Available", "Not Available", "Limited Service"],
default: "Available"
},
{
type: "multifamily",
title: "Multi-Family Offered",
description: "Pest control services for apartment complexes, condominiums, and multi-unit residential properties.",
options: ["Yes", "No", "Property Management Only"],
default: "Yes"
},
{
type: "mobile",
title: "Trailers/Mobile Homes",
description: "Pest control services for mobile homes, trailers, and manufactured housing.",
options: ["Yes", "No", "Restrictions Apply"],
default: "Yes"
}
],
"Scheduling and Operations": [
{
type: "contract",
title: "Signed Contract",
description: "Requirements for signed service agreements before beginning pest control services.",
options: ["Required", "Not Required", "Verbal Agreement OK"],
default: "Required"
},
{
type: "returning",
title: "Returning Customers",
description: "Special policies and procedures for customers returning after service cancellation.",
options: ["Standard Pricing", "Welcome Back Discount", "Re-inspection Required"],
default: "Standard Pricing"
},
{
type: "confirmations",
title: "Appointment Confirmations",
description: "How and when appointment confirmations are sent to customers.",
options: ["24 hours prior", "48 hours prior", "Day of service"],
default: "24 hours prior"
},
{
type: "callahead",
title: "Call Ahead",
description: "Policy for technicians calling customers before arriving for service.",
options: ["Always call", "Call if requested", "No call policy"],
default: "Always call"
},
{
type: "distance",
title: "Max Distance",
description: "Maximum service distance from branch location for regular service calls.",
options: ["25 miles", "50 miles", "75 miles", "No limit"],
default: "50 miles"
},
{
type: "scheduling_times",
title: "Scheduling Policy Times",
description: "Standard time windows and scheduling policies for different service types.",
schedulingLayout: {
"Inspection": "8:00 AM - 5:00 PM",
"Initial/Interior": "8:00 AM - 4:00 PM", 
"Regular": "8:00 AM - 5:00 PM"
},
options: ["Standard Hours", "Extended Hours", "Flexible Schedule"],
default: "Standard Hours"
},
{
type: "sameday",
title: "Same Day Services",
description: "Availability and policies for same-day pest control services.",
options: ["Available", "Emergency Only", "Not Available"],
default: "Emergency Only"
},
{
type: "techskilling",
title: "Tech Skilling",
description: "Technician skill level requirements and specialization policies.",
options: ["All Techs", "Specialized Techs Only", "Senior Techs Preferred"],
default: "All Techs"
},
{
type: "emergency",
title: "After Hours Emergency",
description: "Emergency pest control services outside of normal business hours.",
options: ["Available", "Limited Availability", "Not Available"],
default: "Limited Availability"
}
],
"Service Policies": [
{
type: "reservices",
title: "Reservices",
description: "Policy for repeat service calls within guarantee period due to continued pest activity.",
options: ["Free within 30 days", "Free within 60 days", "Free within 90 days"],
default: "Must allow 10-14 days for product to work. If customer has had more than 2 reservices on account, attempt to upsell service (QPC to Bi or Bi to Monthly). Exception: may schedule within 2 days of treatment for fleas."
},
{
type: "servicetype",
title: "Set Service Type To",
description: "Default service type classification for new service agreements.",
options: ["Monthly", "Quarterly", "Bi-Monthly", "One-Time"],
default: "Quarterly"
},
{
type: "subscription",
title: "Set Subscription Type To",
description: "Default subscription billing model for ongoing pest control services.",
options: ["Contract", "Month-to-Month", "Seasonal"],
default: "Contract"
}
],
"Payment and Financial": [
{
type: "plans",
title: "Payment Plans",
description: "Available payment plan options for pest control services.",
options: ["Full Payment", "Split Payment", "Monthly Installments"],
default: "Full Payment"
},
{
type: "types",
title: "Payment Types",
description: "Accepted payment methods for pest control services.",
options: ["Cash, Check, Credit Card", "Credit Card Only", "Cash and Check Only"],
default: "Cash, Check, Credit Card"
},
{
type: "pastdue",
title: "Past Due Period",
description: "Grace period before accounts are considered past due and subject to late fees.",
options: ["15 days", "30 days", "45 days"],
default: "30 days"
},
{
type: "tools",
title: "Tools to Save",
description: "Available tools and options to help customers save money on pest control services.",
options: ["Annual Discounts", "Referral Credits", "Senior Discounts"],
default: "Annual Discounts"
},
{
type: "cancellation",
title: "Cancellation Policy",
description: "Terms and notice requirements for canceling pest control service contracts.",
options: ["30 day notice", "60 day notice", "End of contract"],
default: "30 day notice"
}
],
"Additional Information": [
{
type: "liability",
title: "Liability and Insurance",
description: "Company maintains full liability insurance coverage. Customer should report any damages or concerns immediately.",
options: ["Full coverage", "Limited coverage", "Customer responsibility"],
default: "Full coverage"
},
{
type: "environmental",
title: "Environmental Safety",
description: "All treatments use EPA-approved products applied according to label instructions. Safety data sheets available upon request.",
options: ["Eco-friendly options", "Standard products", "Premium treatments"],
default: "Standard products"
},
{
type: "satisfaction",
title: "Customer Satisfaction Policy",
description: "Customer satisfaction is our priority. Any service concerns should be reported within 24 hours for prompt resolution.",
options: ["24-hour reporting", "48-hour reporting", "Weekly follow-up"],
default: "24-hour reporting"
}
]
},
serviceAreas: [{
zip: "75001",
city: "Dallas",
state: "TX",
branch: "Dallas North Branch",
territory: "North Dallas",
inService: true
}]
};
}

populateClientData();
}

// Populate the page with client data
function populateClientData() {
// Hide loading, show content
document.getElementById('loadingState').style.display = 'none';

// Update header
document.getElementById('companyName').textContent = clientData.companyName;
document.getElementById('locationInfo').textContent = clientData.location;

// Update sticky header
document.getElementById('stickyCompanyName').textContent = clientData.companyName;

// Update current time for client's timezone
updateCurrentTime(clientData.timezone);

// Load weather forecast
loadWeatherForecast(clientData.location);

// Update links (both regular and sticky)
if (clientData.officeInfo.website) {
document.getElementById('websiteLink').href = clientData.officeInfo.website;
document.getElementById('stickyWebsiteLink').href = clientData.officeInfo.website;
}

// Handle FieldRoutes button configuration
const fieldRoutesBtn = document.getElementById('fieldRoutesLink');
const stickyFieldRoutesBtn = document.getElementById('stickyFieldRoutesLink');

console.log('üîç FieldRoutes Debug - Full clientData:', clientData);
console.log('üîç FieldRoutes Debug - fieldRoutesButton:', clientData.fieldRoutesButton);
console.log('üîç FieldRoutes Debug - Raw FieldRoutes_Button_Text:', clientData.FieldRoutes_Button_Text);
console.log('üîç FieldRoutes Debug - Raw FieldRoutes_Link:', clientData.FieldRoutes_Link);
console.log('üîç FieldRoutes Debug - Button elements found:', !!fieldRoutesBtn, !!stickyFieldRoutesBtn);

if (clientData.fieldRoutesButton && clientData.fieldRoutesButton.show) {
    console.log('‚úÖ FieldRoutes Button should be shown');
    // Update button text
    fieldRoutesBtn.textContent = clientData.fieldRoutesButton.text;
    stickyFieldRoutesBtn.textContent = clientData.fieldRoutesButton.text === 'FieldRoutes' ? 'Routes' : clientData.fieldRoutesButton.text;
    
    // Update button URL
    fieldRoutesBtn.href = clientData.fieldRoutesButton.url;
    stickyFieldRoutesBtn.href = clientData.fieldRoutesButton.url;
    
    // Show buttons
    fieldRoutesBtn.style.display = 'inline-block';
    stickyFieldRoutesBtn.style.display = 'inline-block';
} else {
    console.log('‚ùå FieldRoutes Button being hidden - Reasons:');
    console.log('   - fieldRoutesButton exists:', !!clientData.fieldRoutesButton);
    console.log('   - fieldRoutesButton.show:', clientData.fieldRoutesButton?.show);
    console.log('   - FieldRoutes_Button_Text:', clientData.FieldRoutes_Button_Text);
    console.log('   - FieldRoutes_Link:', clientData.FieldRoutes_Link);
    
    // Hide buttons if not configured
    fieldRoutesBtn.style.display = 'none';
    stickyFieldRoutesBtn.style.display = 'none';
}

// Populate services
populateServices();

// Populate technicians
populateTechnicians();

// Populate policies
populatePolicies();

// Populate service areas
populateServiceAreas();

// Populate bulletin (both original and top info card)
const bulletinText = clientData.bulletin || 'No bulletin information available.';
document.getElementById('bulletinContent').textContent = bulletinText;
document.getElementById('topBulletinContent').textContent = bulletinText;

// Populate pests not covered (both original and top info card)
const pestsText = clientData.pestsNotCovered || 'No pest exclusions listed.';
document.getElementById('pestsNotCoveredContent').textContent = pestsText;
document.getElementById('topPestsNotCoveredContent').textContent = pestsText;

// Show services section by default
showSection('services');
}

// Weather functions
async function loadWeatherForecast(location) {
    try {
        // Get coordinates for the location
        const geoResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
        const geoData = await geoResponse.json();
        
        if (geoData.length === 0) {
            throw new Error('Location not found');
        }
        
        const lat = geoData[0].lat;
        const lon = geoData[0].lon;
        
        // Get weather forecast
        const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto&forecast_days=7&temperature_unit=fahrenheit`);
        const weatherData = await weatherResponse.json();
        
        displayWeatherForecast(weatherData.daily);
    } catch (error) {
        console.error('Error loading weather:', error);
        document.getElementById('weatherContent').innerHTML = 'Weather unavailable';
    }
}

function displayWeatherForecast(dailyData) {
    const weatherContent = document.getElementById('weatherContent');
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    
    let forecastHTML = '';
    
    for (let i = 0; i < 7; i++) {
        const date = new Date();
        date.setDate(date.getDate() + i);
        const dayName = days[date.getDay()];
        
        const maxTemp = Math.round(dailyData.temperature_2m_max[i]);
        const minTemp = Math.round(dailyData.temperature_2m_min[i]);
        const weatherCode = dailyData.weather_code[i];
        const weatherDesc = getWeatherDescription(weatherCode);
        
        forecastHTML += `
            <div class="weather-day">
                <div class="weather-day-name">${dayName}</div>
                <div class="weather-temp">${maxTemp}¬∞</div>
                <div class="weather-desc">${weatherDesc}</div>
            </div>
        `;
    }
    
    weatherContent.innerHTML = forecastHTML;
    
    // Update sticky header with today's weather
    const todayTemp = Math.round(dailyData.temperature_2m_max[0]);
    const todayDesc = getWeatherDescription(dailyData.weather_code[0]);
    updateStickyWeather(`${todayDesc} ${todayTemp}¬∞F`);
}

function getWeatherDescription(code) {
    const weatherCodes = {
        0: '‚òÄÔ∏è',
        1: 'üå§Ô∏è',
        2: '‚õÖ',
        3: '‚òÅÔ∏è',
        45: 'üå´Ô∏è',
        48: 'üå´Ô∏è',
        51: 'üå¶Ô∏è',
        53: 'üå¶Ô∏è',
        55: 'üå¶Ô∏è',
        61: 'üåßÔ∏è',
        63: 'üåßÔ∏è',
        65: 'üåßÔ∏è',
        71: 'üå®Ô∏è',
        73: 'üå®Ô∏è',
        75: 'üå®Ô∏è',
        95: '‚õàÔ∏è'
    };
    return weatherCodes[code] || 'üå§Ô∏è';
}

// Populate services grid
function populateServices() {
const servicesGrid = document.getElementById('servicesGrid');

if (!clientData.services || clientData.services.length === 0) {
servicesGrid.innerHTML = '<div class="info-section"><div class="info-content">No services available.</div></div>';
return;
}

servicesGrid.innerHTML = '';
clientData.services.forEach(service => {
const serviceCard = createServiceCard(service);
servicesGrid.appendChild(serviceCard);
});
}

// Create service card element
function createServiceCard(service) {
const serviceCard = document.createElement('div');
serviceCard.className = 'service-card';

// Generate unique ID for this service's calculator
const serviceId = `service_${Math.random().toString(36).substr(2, 9)}`;
serviceCard.setAttribute('data-service-id', serviceId);

// Check if this service has subservices
if (service.subServices && service.subServices.length > 0) {
// Service with subservices
serviceCard.innerHTML = `
<div class="service-header">
<div class="service-name">${service.name || 'Unnamed Service'}</div>
<div class="service-frequency">Multiple Options</div>
</div>
<div class="service-description">${service.description || 'No description available.'}</div>

${service.agentNote ? `
<!-- Agent Note for Main Service -->
<div class="agent-note">
<div class="agent-note-title">Agent Note</div>
<div class="agent-note-content">${service.agentNote}</div>
</div>
` : ''}

<!-- Service Details -->
<div class="service-details">
<div class="service-details-grid">
<div class="detail-item">
<div class="detail-label">Contract</div>
<div class="detail-value">${service.contract || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Guarantee</div>
<div class="detail-value">${service.guarantee || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Duration</div>
<div class="detail-value">${service.duration || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Service Type</div>
<div class="detail-value">${service.serviceType || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Product Type</div>
<div class="detail-value">${service.productType || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Billing Frequency</div>
<div class="detail-value">${service.billingFrequency || 'N/A'}</div>
</div>
</div>
</div>

<!-- Subservices -->
<div class="subservices-container">
${service.subServices.map((subService, index) => {
const subServiceId = `${serviceId}_sub_${index}`;
return `
<div class="subservice-item">
<div class="subservice-header">
<div class="subservice-name">${subService.name}</div>
<div class="subservice-frequency">${subService.frequency}</div>
</div>
<div class="subservice-description">${subService.description}</div>

${subService.agentNote ? `
<!-- Agent Note for Subservice -->
<div class="agent-note">
<div class="agent-note-title">Agent Note</div>
<div class="agent-note-content">${subService.agentNote}</div>
</div>
` : ''}

<div class="subservice-pests">
<div class="subservice-pests-title">Pests Covered</div>
<div class="subservice-pests-list pests-covered">${subService.pests}</div>
</div>

<!-- Subservice Details -->
<div class="subservice-details">
<div class="subservice-details-grid">
<div class="subservice-detail-item">
<div class="subservice-detail-label">Contract</div>
<div class="subservice-detail-value">${subService.contract || 'N/A'}</div>
</div>
<div class="subservice-detail-item">
<div class="subservice-detail-label">Guarantee</div>
<div class="subservice-detail-value">${subService.guarantee || 'N/A'}</div>
</div>
<div class="subservice-detail-item">
<div class="subservice-detail-label">Duration</div>
<div class="subservice-detail-value">${subService.duration || 'N/A'}</div>
</div>
<div class="subservice-detail-item">
<div class="subservice-detail-label">Service Type</div>
<div class="subservice-detail-value">${subService.serviceType || 'N/A'}</div>
</div>
<div class="subservice-detail-item">
<div class="subservice-detail-label">Product Type</div>
<div class="subservice-detail-value">${subService.productType || 'N/A'}</div>
</div>
<div class="subservice-detail-item">
<div class="subservice-detail-label">Billing Frequency</div>
<div class="subservice-detail-value">${subService.billingFrequency || 'N/A'}</div>
</div>
</div>
</div>

<!-- Pricing Calculator for Subservice -->
<div class="pricing-calculator">
<div class="calculator-title">
üßÆ ${subService.name} Pricing Calculator
</div>
<div class="sqft-input-container">
<input type="number" class="sqft-input" id="sqft_${subServiceId}" placeholder="Enter square footage" min="0" step="1">
<button class="calculate-btn" onclick="calculateSubServicePricing('${subServiceId}', ${index})">Calculate</button>
</div>
<div class="pricing-result" id="result_${subServiceId}">
<div class="pricing-display" id="pricing_${subServiceId}">
<!-- Calculated pricing will appear here -->
</div>
<div class="sqft-range-info" id="range_${subServiceId}">
<!-- Square footage range info will appear here -->
</div>
</div>
</div>
</div>
`;
}).join('')}
</div>
`;

// Store subservices pricing data on the element
serviceCard._subServicesData = service.subServices || [];
} else {
// Regular service without subservices
serviceCard.innerHTML = `
<div class="service-header">
<div class="service-name">${service.name || 'Unnamed Service'}</div>
<div class="service-frequency">${service.frequency || 'N/A'}</div>
</div>
<div class="service-description">${service.description || 'No description available.'}</div>

${service.agentNote ? `
<!-- Agent Note -->
<div class="agent-note">
<div class="agent-note-title">Agent Note</div>
<div class="agent-note-content">${service.agentNote}</div>
</div>
` : ''}

<!-- Pests Covered Section -->
<div class="pests-covered-section">
<div class="pests-covered-title">Pests Covered</div>
<div class="pests-covered-list pests-covered">${service.pests || 'N/A'}</div>
</div>

<!-- Service Details -->
<div class="service-details">
<div class="service-details-grid">
<div class="detail-item">
<div class="detail-label">Contract:</div>
<div class="detail-value">${service.contract || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Guarantee:</div>
<div class="detail-value">${service.guarantee || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Call Ahead:</div>
<div class="detail-value">${service.callAhead || service.callAheadCustom || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Initial Duration:</div>
<div class="detail-value">${service.duration || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Recurring Duration:</div>
<div class="detail-value">${service.recurringDuration || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Leave During Service:</div>
<div class="detail-value">${service.leaveDuringService || service.leaveDuringServiceCustom || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Follow up:</div>
<div class="detail-value">${service.followUp || 'N/A'}</div>
</div>
<div class="detail-item">
<div class="detail-label">Prep Sheet:</div>
<div class="detail-value">${service.prepSheet || service.prepSheetCustom || 'N/A'}</div>
</div>
</div>
</div>

<!-- Pricing Calculator -->
<div class="pricing-calculator">
<div class="calculator-title">
üßÆ Pricing Calculator
</div>

<!-- Service Information -->
<div class="service-info-summary">
${service.productType || service.name} ‚Ä¢ ${service.serviceFrequencyCustom || service.frequency} service ‚Ä¢ Billed ${service.billingFrequencyCustom || service.billingFrequency}
</div>

<div class="sqft-input-container">
<input type="number" class="sqft-input" id="sqft_${serviceId}" placeholder="Enter square footage" min="0" step="1">
<button class="calculate-btn" onclick="calculatePricing('${serviceId}')">Calculate</button>
</div>
<div class="pricing-result" id="result_${serviceId}">
<div class="pricing-display" id="pricing_${serviceId}">
<!-- Calculated pricing will appear here -->
</div>
<div class="sqft-range-info" id="range_${serviceId}">
<!-- Square footage range info will appear here -->
</div>
</div>
</div>
`;

// Store pricing data and service data on the element for the calculator
serviceCard._pricingData = service.pricingTiers || [];
serviceCard._serviceData = service;
}

return serviceCard;
}

// Populate technicians grid
function populateTechnicians() {
const techniciansGrid = document.getElementById('techniciansGrid');

if (!clientData.technicians || clientData.technicians.length === 0) {
techniciansGrid.innerHTML = '<div class="info-section"><div class="info-content">No technician information available.</div></div>';
return;
}

// Populate scheduling policies in quick reference
populateSchedulingPolicies();

techniciansGrid.innerHTML = '';
clientData.technicians.forEach(tech => {
const techCard = createTechnicianCard(tech);
techniciansGrid.appendChild(techCard);
});
}

// Create technician card element
function createTechnicianCard(tech) {
const techCard = document.createElement('div');
techCard.className = 'tech-card';
techCard.setAttribute('data-company', tech.company || '');
techCard.setAttribute('data-role', tech.role || '');
techCard.setAttribute('data-zip-codes', (tech.zipCodes || []).join(','));

// Determine role badge class
let roleBadgeClass = 'technician';
if (tech.role === 'Inspector') roleBadgeClass = 'inspector';
if (tech.role === 'Both') roleBadgeClass = 'both';

// Format schedule display
const scheduleDisplay = tech.schedule || 'Schedule not specified';

// Format restrictions
const restrictions = tech.restrictions || tech.doesNotService || '';
const restrictionDisplay = restrictions ? restrictions : 'No restrictions listed';

// Format additional notes
const notes = tech.notes || tech.additionalNotes || '';

// Generate ZIP code badges if available
let zipCodeDisplay = '';
if (tech.zipCodes && tech.zipCodes.length > 0) {
const zipBadges = tech.zipCodes.map(zip => 
`<span class="zip-badge">${zip}</span>`
).join('');
zipCodeDisplay = `<div class="zip-coverage-list">${zipBadges}</div>`;
}

techCard.innerHTML = `
<div class="tech-header">
<div>
<h3 class="tech-name">${tech.name || 'Unknown Technician'}</h3>
<div class="tech-company">${tech.company || 'Unknown Company'}</div>
</div>
<span class="tech-role-badge ${roleBadgeClass}">${tech.role || 'Technician'}</span>
</div>

<div class="tech-details">
<div class="tech-detail">
<div class="tech-detail-label">Max Stops</div>
<div class="tech-detail-value">${tech.maxStops || 'Not specified'}</div>
</div>
<div class="tech-detail">
<div class="tech-detail-label">Phone</div>
<div class="tech-detail-value">${tech.phone || 'Not provided'}</div>
</div>
</div>

<div class="tech-schedule">
<div class="tech-schedule-title">
üïê Schedule
</div>
<div class="tech-schedule-value">${scheduleDisplay}</div>
</div>

${restrictions ? `
<div class="tech-restrictions">
<div class="tech-restrictions-title">
üö´ Does NOT Service
</div>
<div class="tech-restrictions-value">${restrictionDisplay}</div>
</div>
` : ''}

${notes ? `
<div class="tech-notes">
<div class="tech-notes-title">
üìù Additional Notes
</div>
<div class="tech-notes-value">${notes}</div>
</div>
` : ''}

${zipCodeDisplay}
`;

return techCard;
}

// Populate scheduling policies in quick reference
function populateSchedulingPolicies() {
console.log('üîÑ Populating scheduling policies...');
console.log('üìã Available policies:', clientData.policies);

// Get scheduling policies from clientData using new organized structure
const policies = clientData.policies || {};
const schedulingPolicies = policies['Scheduling'] || [];

// Also check other possible categories for backward compatibility
const allPolicies = [];
Object.keys(policies).forEach(category => {
  if (Array.isArray(policies[category])) {
    allPolicies.push(...policies[category]);
  }
});

console.log('üìã Scheduling policies found:', schedulingPolicies);
console.log('üìã All policies for debugging:', allPolicies);

// Find specific policies by title (matching our new policy structure)
// First try in Scheduling category, then search all policies as fallback
let schedulingTimes = schedulingPolicies.find(p => p.title === 'Scheduling Times' || p.description === 'Available scheduling times');
let maxDistance = schedulingPolicies.find(p => p.title && p.title.includes('Max Distance'));
let sameDay = schedulingPolicies.find(p => p.title && p.title.includes('Same Day Services'));
let confirmations = schedulingPolicies.find(p => p.title && p.title.includes('Appointment confirmations'));
let reservices = schedulingPolicies.find(p => p.title && p.title.includes('Reservices'));

// Fallback: search in all policies if not found in Scheduling category
if (!schedulingTimes) {
  schedulingTimes = allPolicies.find(p => p.title && (p.title.includes('Inspection:') || p.title.includes('Initial/Interior:') || p.title.includes('Regular:') || p.description === 'Available scheduling times'));
}
if (!maxDistance) {
  maxDistance = allPolicies.find(p => p.title && p.title.includes('Max Distance'));
}
if (!sameDay) {
  sameDay = allPolicies.find(p => p.title && p.title.includes('Same Day Services'));
}
if (!confirmations) {
  confirmations = allPolicies.find(p => p.title && p.title.includes('Appointment confirmations'));
}
if (!reservices) {
  reservices = allPolicies.find(p => p.title && p.title.includes('Reservices'));
}

console.log('üîç All scheduling policies:', schedulingPolicies);
console.log('üîç Found specific policies:', { schedulingTimes, maxDistance, sameDay, confirmations, reservices });

// Update the quick reference display with proper formatting
const schedulingTimesElement = document.getElementById('defaultSchedulingTimes');
console.log('üîç Scheduling times policy found:', schedulingTimes);

if (schedulingTimes && (schedulingTimes.value || schedulingTimes.default)) {
  const schedulingText = schedulingTimes.value || schedulingTimes.default;
  console.log('üìã Raw scheduling text:', schedulingText);
  
  // Format the scheduling times with proper line breaks and bold labels
  // Handle both \n\n and \n line breaks
  const formattedText = schedulingText
    .replace(/\n\n/g, '\n') // Convert double line breaks to single
    .replace(/Inspection:/g, '<strong>Inspection:</strong>')
    .replace(/Initial\/Interior:/g, '<br><strong>Initial/Interior:</strong>')
    .replace(/Regular:/g, '<br><strong>Regular:</strong>');
  
  console.log('üìã Formatted scheduling text:', formattedText);
  schedulingTimesElement.innerHTML = formattedText;
} else {
  console.log('‚ùå No scheduling times policy found');
  schedulingTimesElement.textContent = 'Not specified';
}

document.getElementById('maxDistance').textContent = 
maxDistance ? (maxDistance.value || maxDistance.default || 'Not specified') : 'Not specified';

document.getElementById('sameDayPolicy').textContent = 
sameDay ? (sameDay.value || sameDay.default || 'Not specified') : 'Not specified';

document.getElementById('confirmationPolicy').textContent = 
confirmations ? (confirmations.value || confirmations.default || 'Not specified') : 'Not specified';

// Update service policies if elements exist
const reservicesPolicyElement = document.getElementById('reservicesPolicy');
if (reservicesPolicyElement) {
reservicesPolicyElement.textContent = 
reservices ? (reservices.value || reservices.default || 'Not specified') : 'Not specified';
}

console.log('‚úÖ Scheduling policies populated');
}

// Toggle reservice policies visibility
function toggleReservicePolicies() {
const details = document.getElementById('reservicesDetails');
const toggleText = document.getElementById('toggleText');
const toggleIcon = document.getElementById('toggleIcon');

if (details.style.display === 'none') {
details.style.display = 'flex';
toggleText.textContent = 'Hide Reservice Details';
toggleIcon.classList.add('rotated');
} else {
details.style.display = 'none';
toggleText.textContent = 'Show Reservice Details';
toggleIcon.classList.remove('rotated');
}
}

// Find technician by ZIP code
function findTechByZip() {
const zip = document.getElementById('zipLookup').value.trim();
if (!zip || !/^\d{5}$/.test(zip)) {
alert('Please enter a valid 5-digit ZIP code');
return;
}

// Find technicians that service this ZIP
const matchingTechs = clientData.technicians.filter(tech => {
return tech.zipCodes && tech.zipCodes.includes(zip);
});

if (matchingTechs.length > 0) {
showSearchResults(`Technicians servicing ZIP ${zip}`, matchingTechs);
} else {
showSearchResults(`No technicians found for ZIP ${zip}`, []);
}
}

// Filter by service type
function filterByServiceType() {
const serviceType = document.getElementById('serviceTypeLookup').value;
if (!serviceType) {
showAllTechs();
return;
}

let matchingTechs = [];
switch(serviceType) {
case 'inspection':
matchingTechs = clientData.technicians.filter(tech => 
tech.role === 'Inspector' || tech.role === 'Both'
);
break;
case 'technician':
matchingTechs = clientData.technicians.filter(tech => 
tech.role === 'Technician' || tech.role === 'Both'
);
break;
case 'both':
matchingTechs = clientData.technicians.filter(tech => 
tech.role === 'Both'
);
break;
}

showSearchResults(`${serviceType.charAt(0).toUpperCase() + serviceType.slice(1)} Results`, matchingTechs);
}

// Show search results
function showSearchResults(title, techs) {
const searchResults = document.getElementById('techSearchResults');
const resultsContent = document.getElementById('searchResultsContent');
const techniciansGrid = document.getElementById('techniciansGrid');

// Hide main grid
techniciansGrid.style.display = 'none';

// Show search results
searchResults.style.display = 'block';
searchResults.querySelector('h3').textContent = title;

if (techs.length === 0) {
resultsContent.innerHTML = `
<div class="info-section">
<div class="info-content">No technicians found matching your criteria.</div>
</div>
`;
} else {
resultsContent.innerHTML = '';
const searchGrid = document.createElement('div');
searchGrid.className = 'technicians-grid';

techs.forEach(tech => {
const techCard = createTechnicianCard(tech);
searchGrid.appendChild(techCard);
});
resultsContent.appendChild(searchGrid);
}
}

// Clear search and show all techs
function clearTechSearch() {
document.getElementById('techSearchResults').style.display = 'none';
document.getElementById('techniciansGrid').style.display = 'grid';
document.getElementById('zipLookup').value = '';
document.getElementById('serviceTypeLookup').value = '';
}

// Show all technicians
function showAllTechs() {
clearTechSearch();
}

// Populate policies grid
function populatePolicies() {
const policiesGrid = document.getElementById('policiesGrid');

if (!clientData.policies || Object.keys(clientData.policies).length === 0) {
policiesGrid.innerHTML = '<div class="info-section"><div class="info-content">No policy information available.</div></div>';
return;
}

// Create the organized policies layout, excluding Service Policies (moved to scheduling)
const allPolicyGroups = Object.keys(clientData.policies);
const policyGroups = allPolicyGroups.filter(groupName => groupName !== 'Service Policies');

if (policyGroups.length === 0) {
policiesGrid.innerHTML = '<div class="info-section"><div class="info-content">All policies have been moved to their respective sections.</div></div>';
return;
}

policiesGrid.innerHTML = `
<div class="policies-container">
<div class="policies-sidebar">
${policyGroups.map(groupName => `
<button class="policy-group-btn" onclick="showPolicyGroup('${groupName}')" id="btn-${groupName.replace(/\s+/g, '-').toLowerCase()}">
${groupName}
</button>
`).join('')}
</div>
<div class="policies-main">
${policyGroups.map(groupName => {
const policies = clientData.policies[groupName];
return `
<div class="policy-group-content" id="content-${groupName.replace(/\s+/g, '-').toLowerCase()}">
<div class="policy-group-title">${groupName}</div>
${policies.map(policy => `
<div class="policy-item">
<div class="policy-item-title">${policy.title || 'Unknown Policy'}</div>
<div class="policy-item-description">${policy.description || 'No description available.'}</div>
${policy.schedulingLayout ? `
<div class="policy-details">
<div class="policy-detail" style="grid-column: 1 / -1;">
<div class="policy-detail-label">Available Service Windows</div>
<div class="policy-detail-value">
${Object.entries(policy.schedulingLayout).map(([serviceType, hours]) => 
`<div style="margin-bottom: 0.5rem;"><strong>${serviceType}:</strong> ${hours}</div>`
).join('')}
</div>
</div>
</div>
` : `
<div class="policy-details">
<div class="policy-detail">
<div class="policy-detail-label">${getAgentLabel(policy.type)}</div>
<div class="policy-detail-value">${policy.value || policy.default || 'Not specified'}</div>
</div>
</div>
`}
</div>
`).join('')}
</div>
`;
}).join('')}
</div>
</div>
`;

// Show first group by default
if (policyGroups.length > 0) {
showPolicyGroup(policyGroups[0]);
}
}

// Function to show specific policy group
function showPolicyGroup(groupName) {
// Remove active class from all buttons and content
document.querySelectorAll('.policy-group-btn').forEach(btn => btn.classList.remove('active'));
document.querySelectorAll('.policy-group-content').forEach(content => content.classList.remove('active'));

// Add active class to selected button and content
const btnId = 'btn-' + groupName.replace(/\s+/g, '-').toLowerCase();
const contentId = 'content-' + groupName.replace(/\s+/g, '-').toLowerCase();
document.getElementById(btnId).classList.add('active');
document.getElementById(contentId).classList.add('active');
}

// Helper function to get agent-friendly labels for policy types
function getAgentLabel(policyType) {
const labels = {
'vehicles': 'We Service Vehicles',
'commercial': 'Commercial Service Available',
'multifamily': 'Multi-Family Properties',
'mobile': 'Mobile Homes/Trailers',
'contract': 'Contract Required',
'returning': 'Returning Customer Policy',
'confirmations': 'Appointment Confirmation',
'callahead': 'Technician Call Ahead Policy',
'distance': 'Maximum Service Distance',
'sameday': 'Same Day Service',
'techskilling': 'Technician Assignment',
'emergency': 'After Hours Emergency',
'reservices': 'Callback Service Period',
'servicetype': 'Standard Service Type',
'subscription': 'Billing Structure',
'plans': 'Payment Plan Options',
'types': 'Accepted Payment Methods',
'pastdue': 'Payment Grace Period',
'tools': 'Available Discounts',
'cancellation': 'Cancellation Notice Required',
'liability': 'Insurance Coverage',
'environmental': 'Product Safety Standards',
'satisfaction': 'Issue Reporting Window'
};
return labels[policyType] || '';
}

// Populate service areas grid
function populateServiceAreas() {
const serviceAreasGrid = document.getElementById('serviceAreasGrid');

if (!clientData.serviceAreas || clientData.serviceAreas.length === 0) {
serviceAreasGrid.innerHTML = '<div class="info-section"><div class="info-content">No service area information available.</div></div>';
return;
}

// Group by branch for better organization
const groupedAreas = clientData.serviceAreas.reduce((groups, area) => {
const branch = area.branch || 'Unknown Branch';
if (!groups[branch]) groups[branch] = [];
groups[branch].push(area);
return groups;
}, {});

serviceAreasGrid.innerHTML = '';
Object.entries(groupedAreas).forEach(([branch, areas]) => {
const branchCard = document.createElement('div');
branchCard.className = 'service-card';
branchCard.innerHTML = `
<div class="service-name">${branch}</div>
<div class="service-pricing" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));">
${areas.map(area => `
<div class="price-item">
<div class="price-label">${area.zip}</div>
<div class="price-value" style="color: ${area.inService ? '#10b981' : '#ef4444'}">
${area.city}, ${area.state}
</div>
</div>
`).join('')}
</div>
`;
serviceAreasGrid.appendChild(branchCard);
});
}

// Navigation functions
function showSection(sectionName) {
// Hide all sections
document.querySelectorAll('.content-section').forEach(section => {
section.classList.remove('active');
});

// Remove active class from all nav buttons
document.querySelectorAll('.nav-btn').forEach(btn => {
btn.classList.remove('active');
});

// Show target section
document.getElementById(sectionName + 'Section').classList.add('active');

// Set active nav button
if (event && event.target) {
event.target.classList.add('active');
} else {
// Find and activate the correct button if called programmatically
const buttons = document.querySelectorAll('.nav-btn');
buttons.forEach(btn => {
if (btn.textContent.toLowerCase().includes(sectionName.toLowerCase())) {
btn.classList.add('active');
}
});
}
}

// Tool functions
function convertAcres() {
const acres = parseFloat(document.getElementById('acresInput').value);
const resultDiv = document.getElementById('conversionResult');

if (isNaN(acres) || acres <= 0) {
resultDiv.textContent = 'Please enter a valid number';
resultDiv.style.color = '#ef4444';
return;
}

const sqft = Math.round(acres * 43560);
resultDiv.textContent = `${sqft.toLocaleString()} sq ft`;
resultDiv.style.color = '#10b981';
}

function checkZip() {
const zip = document.getElementById('zipInput').value.trim();
const resultDiv = document.getElementById('zipResult');

console.log('üîç Checking ZIP:', zip);
console.log('üìã Available service areas:', clientData.serviceAreas);

if (!/^\d{5}$/.test(zip)) {
resultDiv.textContent = 'Please enter a valid 5-digit ZIP';
resultDiv.style.color = '#ef4444';
return;
}

// Check against loaded service areas if available
if (clientData.serviceAreas && clientData.serviceAreas.length > 0) {
console.log('üîç Searching for ZIP in service areas...');
clientData.serviceAreas.forEach((area, index) => {
  console.log(`Area ${index}:`, area);
  console.log(`ZIP comparison: "${area.zip}" === "${zip}" ?`, area.zip === zip);
  console.log(`ZIP comparison (string): "${area.zip?.toString()}" === "${zip}" ?`, area.zip?.toString() === zip);
});

const foundArea = clientData.serviceAreas.find(area => area.zip === zip || area.zip?.toString() === zip);
console.log('üîç Found area:', foundArea);

if (foundArea) {
resultDiv.textContent = `‚úì ${foundArea.branch || foundArea.city} - ${foundArea.city}, ${foundArea.state}`;
resultDiv.style.color = foundArea.inService ? '#10b981' : '#ef4444';
} else {
resultDiv.textContent = '‚úó Not in service area';
resultDiv.style.color = '#ef4444';
}
} else {
// Fallback sample zip lookup
const serviceAreas = {
'75001': 'Dallas North Branch',
'75002': 'Dallas North Branch',
'77001': 'Houston Central Branch',
'78701': 'Austin Branch',
'73301': 'Austin Branch'
};

if (serviceAreas[zip]) {
resultDiv.textContent = `‚úì ${serviceAreas[zip]}`;
resultDiv.style.color = '#10b981';
} else {
resultDiv.textContent = '‚úó Not in service area';
resultDiv.style.color = '#ef4444';
}
}
}

// Modal functions
function openOfficeModal() {
const modal = document.getElementById('officeModal');
const officeInfo = document.getElementById('officeInfo');

officeInfo.innerHTML = `
<div class="office-item">
<span class="office-label">Phone:</span>
<span class="office-value">${clientData.officeInfo.phone || 'Not available'}</span>
</div>
<div class="office-item">
<span class="office-label">Email:</span>
<span class="office-value">${clientData.officeInfo.email || 'Not available'}</span>
</div>
<div class="office-item">
<span class="office-label">Address:</span>
<span class="office-value">${clientData.officeInfo.physicalAddress || 'Not available'}</span>
</div>
<div class="office-item">
<span class="office-label">Hours:</span>
<span class="office-value">${clientData.officeInfo.officeHours || 'Not available'}</span>
</div>
`;

modal.style.display = 'block';
}

function closeOfficeModal() {
document.getElementById('officeModal').style.display = 'none';
}

// Time zone updates
function updateCurrentTime(timezone) {
const timeZoneMap = {
'Pacific': 'America/Los_Angeles',
'Mountain': 'America/Denver', 
'Central': 'America/Chicago',
'Eastern': 'America/New_York'
};

const timeZone = timeZoneMap[timezone] || 'America/Chicago';
console.log('üïí Updating time - Input timezone:', timezone, '‚Üí Using:', timeZone);

function updateTime() {
const now = new Date();
const localTime = now.toLocaleTimeString('en-US', {
hour: '2-digit',
minute: '2-digit',
timeZone: timeZone
});

document.getElementById('currentTime').textContent = localTime;
document.getElementById('stickyTime').textContent = localTime;
}

updateTime();
setInterval(updateTime, 60000); // Update every minute
}

// Sticky header functionality
let stickyHeaderScrollHandler = null;
let isTransitioning = false;

function initializeStickyHeader() {
const stickyHeader = document.getElementById('stickyHeader');
const header = document.querySelector('.header');
const navSidebar = document.querySelector('.nav-sidebar');
const toolsSidebar = document.querySelector('.tools-sidebar');

if (!stickyHeader || !header) {
console.log('Sticky header elements not found, retrying...');
setTimeout(initializeStickyHeader, 200);
return;
}

let headerHeight = header.offsetHeight;
console.log('Header height detected:', headerHeight);

// Remove any existing scroll listeners to avoid duplicates
if (stickyHeaderScrollHandler) {
window.removeEventListener('scroll', stickyHeaderScrollHandler);
}

let ticking = false;

stickyHeaderScrollHandler = function() {
if (!ticking && !isTransitioning) {
requestAnimationFrame(function() {
const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

// Add hysteresis - different thresholds for showing and hiding
const showThreshold = headerHeight + 50;
const hideThreshold = headerHeight + 20;
const isHeaderVisible = stickyHeader.classList.contains('show');

if (!isHeaderVisible && scrollTop > showThreshold) {
console.log('Showing sticky header at:', scrollTop);
isTransitioning = true;
stickyHeader.classList.add('show');
if (navSidebar) navSidebar.classList.add('sticky-header-active');
if (toolsSidebar) toolsSidebar.classList.add('sticky-header-active');
setTimeout(() => { isTransitioning = false; }, 300);
} else if (isHeaderVisible && scrollTop < hideThreshold) {
console.log('Hiding sticky header at:', scrollTop);
isTransitioning = true;
stickyHeader.classList.remove('show');
if (navSidebar) navSidebar.classList.remove('sticky-header-active');
if (toolsSidebar) toolsSidebar.classList.remove('sticky-header-active');
setTimeout(() => { isTransitioning = false; }, 300);
}
ticking = false;
});
ticking = true;
}
};

window.addEventListener('scroll', stickyHeaderScrollHandler, { passive: true });

console.log('Sticky header initialized successfully');
}

// Update sticky weather display
function updateStickyWeather(weatherText) {
document.getElementById('stickyWeather').textContent = weatherText;
}

// Search functionality with popup
function searchPests() {
const searchTerm = document.getElementById('pestSearch').value.toLowerCase().trim();
if (!searchTerm) {
hideSearchPopup();
return;
}

let foundInServices = [];
let foundInNotCovered = false;
let exactMatchInServices = false;

// Search in services - check for exact matches first
clientData.services.forEach(service => {
// Check main service pests
if (service.pests) {
const pestsLower = service.pests.toLowerCase();
const pestsList = pestsLower.split(',').map(p => p.trim());

// Check for exact match first
if (pestsList.includes(searchTerm)) {
foundInServices.push({
name: service.name,
type: 'main',
exactMatch: true
});
exactMatchInServices = true;
} else if (pestsLower.includes(searchTerm)) {
foundInServices.push({
name: service.name,
type: 'main',
exactMatch: false
});
}
}

// Check subservice pests
if (service.subServices) {
service.subServices.forEach(subService => {
if (subService.pests) {
const subPestsLower = subService.pests.toLowerCase();
const subPestsList = subPestsLower.split(',').map(p => p.trim());

// Check for exact match first
if (subPestsList.includes(searchTerm)) {
foundInServices.push({
name: `${service.name} (${subService.name})`,
type: 'sub',
exactMatch: true
});
exactMatchInServices = true;
} else if (subPestsLower.includes(searchTerm)) {
foundInServices.push({
name: `${service.name} (${subService.name})`,
type: 'sub',
exactMatch: false
});
}
}
});
}
});

// Check pests not covered - but be more specific about matches
let exactMatchInNotCovered = false;
if (clientData.pestsNotCovered) {
const notCoveredLower = clientData.pestsNotCovered.toLowerCase();
const notCoveredList = notCoveredLower.split(',').map(p => p.trim());

// Check for exact match in not covered
exactMatchInNotCovered = notCoveredList.includes(searchTerm);

// Only flag as "not covered" if no exact service match AND either exact not-covered match OR partial match
if (!exactMatchInServices && (exactMatchInNotCovered || notCoveredLower.includes(searchTerm))) {
foundInNotCovered = true;
}
}

// Show popup with results
showSearchPopup(searchTerm, foundInServices, foundInNotCovered, exactMatchInServices);
}

function showSearchPopup(searchTerm, foundInServices, foundInNotCovered, exactMatchInServices) {
const popup = document.getElementById('searchPopup');
const content = document.getElementById('searchPopupContent');

let popupHTML = '';

// Show service results first if any
if (foundInServices.length > 0) {
// Sort results to show exact matches first
foundInServices.sort((a, b) => b.exactMatch - a.exactMatch);

const headerText = exactMatchInServices ? 
`<div class="search-popup-header">‚úÖ "${searchTerm}" is COVERED in:</div>` :
`<div class="search-popup-header">üîç Found "${searchTerm}" in:</div>`;

popupHTML += headerText;

foundInServices.forEach(service => {
const matchType = service.exactMatch ? '‚úÖ' : 'üîç';
const cssClass = service.exactMatch ? 'covered' : '';
popupHTML += `
<div class="search-popup-item ${cssClass}" onclick="selectSearchResult('${service.name}', '${searchTerm}')">
<div>
<span class="search-popup-item-icon">${matchType}</span>
<span class="search-popup-item-text">${service.name}</span>
</div>
<div class="search-popup-item-detail">Click to view service details</div>
</div>
`;
});
}

// Show not covered warning if relevant
if (foundInNotCovered && foundInServices.length > 0) {
popupHTML += `
<div class="search-popup-item warning">
<div>
<span class="search-popup-item-icon">‚ö†Ô∏è</span>
<span class="search-popup-item-text">Some types may not be covered</span>
</div>
<div class="search-popup-item-detail">Check service details for specifics</div>
</div>
`;
} else if (foundInNotCovered && foundInServices.length === 0) {
popupHTML += `
<div class="search-popup-header">‚ö†Ô∏è "${searchTerm}" is NOT COVERED</div>
<div class="search-popup-item not-covered">
<div>
<span class="search-popup-item-icon">üö´</span>
<span class="search-popup-item-text">Found in exclusions list</span>
</div>
<div class="search-popup-item-detail">${clientData.pestsNotCovered}</div>
</div>
`;
}

// No results found
if (foundInServices.length === 0 && !foundInNotCovered) {
popupHTML += `
<div class="search-popup-header">‚ùì No coverage found for "${searchTerm}"</div>
<div class="search-popup-item">
<div>
<span class="search-popup-item-icon">üìû</span>
<span class="search-popup-item-text">Contact office for details</span>
</div>
<div class="search-popup-item-detail">Pest may require special treatment</div>
</div>
`;
}

content.innerHTML = popupHTML;
popup.style.display = 'block';

// Update the tool result text
const resultEl = document.getElementById('pestSearchResult');
if (resultEl) {
if (foundInServices.length > 0) {
resultEl.textContent = exactMatchInServices ? `‚úÖ "${searchTerm}" is covered` : `üîç Found "${searchTerm}"`;
resultEl.style.color = exactMatchInServices ? '#10b981' : '#60a5fa';
} else if (foundInNotCovered) {
resultEl.textContent = `‚ö†Ô∏è "${searchTerm}" not covered`;
resultEl.style.color = '#ef4444';
} else {
resultEl.textContent = `‚ùì No results for "${searchTerm}"`;
resultEl.style.color = '#94a3b8';
}
}
}

function selectSearchResult(serviceName, searchTerm) {
hideSearchPopup();
navigateToService(serviceName, searchTerm);
}

function hideSearchPopup() {
const popup = document.getElementById('searchPopup');
if (popup) popup.style.display = 'none';
}

// Navigate to service function
function navigateToService(serviceName, searchTerm) {
// Switch to services section
showSection('services');
// Filter and highlight the specific service
filterServicesByPest(searchTerm);
// Scroll to the service (with a small delay to ensure the section is shown)
setTimeout(() => {
const serviceCards = document.querySelectorAll('.service-card');
serviceCards.forEach(card => {
const serviceNameElement = card.querySelector('.service-name, .subservice-name');
if (serviceNameElement && serviceNameElement.textContent.includes(serviceName.split(' (')[0])) {
card.scrollIntoView({ behavior: 'smooth', block: 'center' });
card.style.border = '2px solid #60a5fa';
card.style.boxShadow = '0 0 20px rgba(96, 165, 250, 0.4)';
// Remove highlight after 3 seconds
setTimeout(() => {
card.style.border = '1px solid #475569';
card.style.boxShadow = 'none';
}, 3000);
}
});
}, 300);
}

function clearSearch() {
document.getElementById('pestSearch').value = '';
hideSearchPopup();

// Reset the result text to match other tools
const resultEl = document.getElementById('pestSearchResult');
if (resultEl) resultEl.textContent = 'Enter pest name to search';

// Remove any alerts
const pestsAlert = document.getElementById('pestsNotCoveredAlert');
if (pestsAlert) pestsAlert.classList.remove('show');

// Show all services again
populateServices();
}

function filterServicesByPest(searchTerm) {
const servicesGrid = document.getElementById('servicesGrid');
servicesGrid.innerHTML = '';

clientData.services.forEach(service => {
let hasMatch = false;

// Check main service pests
if (service.pests && service.pests.toLowerCase().includes(searchTerm)) {
hasMatch = true;
}

// Check subservice pests
if (service.subServices) {
service.subServices.forEach(subService => {
if (subService.pests && subService.pests.toLowerCase().includes(searchTerm)) {
hasMatch = true;
}
});
}

if (hasMatch) {
const serviceCard = createServiceCard(service);

// Add highlight to the pest term in main service
const pestsElement = serviceCard.querySelector('.pests-covered');
if (pestsElement) {
pestsElement.innerHTML = pestsElement.innerHTML.replace(
new RegExp(`(${searchTerm})`, 'gi'),
'<span class="search-highlight">$1</span>'
);
}

// Add highlight to the pest term in subservices
const subServicePests = serviceCard.querySelectorAll('.subservice-pests-list');
subServicePests.forEach(element => {
element.innerHTML = element.innerHTML.replace(
new RegExp(`(${searchTerm})`, 'gi'),
'<span class="search-highlight">$1</span>'
);
});

servicesGrid.appendChild(serviceCard);
}
});

// Show services section
showSection('services');
}

// Pricing calculation functions
function calculatePricing(serviceId) {
const sqft = parseInt(document.getElementById(`sqft_${serviceId}`).value);
const resultDiv = document.getElementById(`result_${serviceId}`);
const pricingDiv = document.getElementById(`pricing_${serviceId}`);
const rangeDiv = document.getElementById(`range_${serviceId}`);

if (!sqft || sqft <= 0) {
resultDiv.classList.remove('show');
return;
}

// Find the service card and get its pricing data
const serviceCard = document.querySelector(`[data-service-id="${serviceId}"]`);

if (!serviceCard || !serviceCard._pricingData) {
pricingDiv.innerHTML = '<div class="price-display-item"><div class="price-display-value">No pricing tiers available</div></div>';
rangeDiv.textContent = '';
resultDiv.classList.add('show');
return;
}

const pricingTiers = serviceCard._pricingData;

// Find the appropriate pricing tier
const tier = pricingTiers.find(t => sqft >= t.sqftMin && sqft <= t.sqftMax);

if (tier) {
pricingDiv.innerHTML = `
<div class="price-display-item">
<div class="price-display-label">First Service</div>
<div class="price-display-value">${tier.firstPrice}</div>
</div>
<div class="price-display-item">
<div class="price-display-label">Recurring</div>
<div class="price-display-value">${tier.recurringPrice}</div>
</div>
<div class="price-display-item">
<div class="price-display-label">Service Type</div>
<div class="price-display-value">${tier.serviceType}</div>
</div>
`;
rangeDiv.textContent = `Valid for ${tier.sqftMin.toLocaleString()} - ${tier.sqftMax.toLocaleString()} sq ft`;
} else {
pricingDiv.innerHTML = `
<div class="price-display-item">
<div class="price-display-value">No pricing available for ${sqft.toLocaleString()} sq ft</div>
</div>
`;
rangeDiv.textContent = 'Please contact office for custom pricing';
}

resultDiv.classList.add('show');
}

// Subservice pricing calculation function
function calculateSubServicePricing(subServiceId, subServiceIndex) {
const sqft = parseInt(document.getElementById(`sqft_${subServiceId}`).value);
const resultDiv = document.getElementById(`result_${subServiceId}`);
const pricingDiv = document.getElementById(`pricing_${subServiceId}`);
const rangeDiv = document.getElementById(`range_${subServiceId}`);

if (!sqft || sqft <= 0) {
resultDiv.classList.remove('show');
return;
}

// Find the parent service card and get its subservices data
const serviceCard = document.querySelector(`[data-service-id="${subServiceId.split('_sub_')[0]}"]`);

if (!serviceCard || !serviceCard._subServicesData || !serviceCard._subServicesData[subServiceIndex]) {
pricingDiv.innerHTML = '<div class="price-display-item"><div class="price-display-value">No pricing tiers available</div></div>';
rangeDiv.textContent = '';
resultDiv.classList.add('show');
return;
}

const subService = serviceCard._subServicesData[subServiceIndex];
const pricingTiers = subService.pricingTiers || [];

// Find the appropriate pricing tier
const tier = pricingTiers.find(t => sqft >= t.sqftMin && sqft <= t.sqftMax);

if (tier) {
pricingDiv.innerHTML = `
<div class="price-display-item">
<div class="price-display-label">First Service</div>
<div class="price-display-value">${tier.firstPrice}</div>
</div>
<div class="price-display-item">
<div class="price-display-label">Recurring</div>
<div class="price-display-value">${tier.recurringPrice}</div>
</div>
<div class="price-display-item">
<div class="price-display-label">Service Type</div>
<div class="price-display-value">${tier.serviceType}</div>
</div>
`;
rangeDiv.textContent = `Valid for ${tier.sqftMin.toLocaleString()} - ${tier.sqftMax.toLocaleString()} sq ft`;
} else {
pricingDiv.innerHTML = `
<div class="price-display-item">
<div class="price-display-value">No pricing available for ${sqft.toLocaleString()} sq ft</div>
</div>
`;
rangeDiv.textContent = 'Please contact office for custom pricing';
}

resultDiv.classList.add('show');
}

// Close modal when clicking outside
window.onclick = function(event) {
const modal = document.getElementById('officeModal');
if (event.target == modal) {
closeOfficeModal();
}
}

// Add Enter key support for search and pricing calculators
document.addEventListener('DOMContentLoaded', function() {
// Handle enter key for search
document.getElementById('pestSearch').addEventListener('keypress', function(e) {
if (e.key === 'Enter') {
searchPests();
}
});

// Handle input changes for real-time search
document.getElementById('pestSearch').addEventListener('input', function(e) {
const value = e.target.value.trim();
if (value.length > 2) {
searchPests();
} else if (value.length === 0) {
clearSearch();
} else {
hideSearchPopup();
}
});

// Hide popup when clicking outside
document.addEventListener('click', function(e) {
const searchInput = document.getElementById('pestSearch');
const popup = document.getElementById('searchPopup');

// Check if click is outside both the input and popup
if (!searchInput.contains(e.target) && !popup.contains(e.target) && popup.style.display === 'block') {
hideSearchPopup();
}
});

// Handle enter key for pricing calculators (delegated event handling)
document.addEventListener('keypress', function(e) {
if (e.key === 'Enter' && e.target.classList.contains('sqft-input')) {
const inputId = e.target.id;
if (inputId.includes('sqft_')) {
const serviceId = inputId.replace('sqft_', '');
calculatePricing(serviceId);
}
}
});
});

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
loadProfileData();
});

// Initialize sticky header after the page is fully loaded
window.addEventListener('load', function() {
console.log('Page fully loaded, initializing sticky header...');
setTimeout(() => {
initializeStickyHeader();
}, 200);
});
</script>
</body>
</html>
